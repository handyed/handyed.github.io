<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Real-TimeCalendarwithWorkSchedule</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 10px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%),
                  url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><linearGradient id="skyGrad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:%23e6f3ff;stop-opacity:1" /><stop offset="100%" style="stop-color:%23cce7ff;stop-opacity:1" /></linearGradient><linearGradient id="buildingGrad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:%23d4d4d8;stop-opacity:1" /><stop offset="100%" style="stop-color:%23a1a1aa;stop-opacity:1" /></linearGradient></defs><rect width="1200" height="800" fill="url(%23skyGrad)"/><rect x="200" y="300" width="200" height="400" fill="url(%23buildingGrad)" stroke="%23737373" stroke-width="2"/><rect x="500" y="200" width="300" height="500" fill="url(%23buildingGrad)" stroke="%23737373" stroke-width="2"/><rect x="900" y="350" width="180" height="350" fill="url(%23buildingGrad)" stroke="%23737373" stroke-width="2"/><rect x="220" y="320" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="250" y="320" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="280" y="320" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="320" y="320" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="350" y="320" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="220" y="360" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="250" y="360" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="280" y="360" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="320" y="360" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="350" y="360" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="220" y="400" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="250" y="400" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="280" y="400" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="320" y="400" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="350" y="400" width="15" height="20" fill="%234a90e2" opacity="0.8"/><rect x="520" y="240" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="560" y="240" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="600" y="240" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="640" y="240" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="680" y="240" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="720" y="240" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="760" y="240" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="520" y="300" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="560" y="300" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="600" y="300" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="640" y="300" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="680" y="300" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="720" y="300" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="760" y="300" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="520" y="360" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="560" y="360" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="600" y="360" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="640" y="360" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="680" y="360" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="720" y="360" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="760" y="360" width="20" height="25" fill="%234a90e2" opacity="0.8"/><rect x="920" y="380" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="950" y="380" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="980" y="380" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="1010" y="380" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="1040" y="380" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="920" y="420" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="950" y="420" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="980" y="420" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="1010" y="420" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="1040" y="420" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="920" y="460" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="950" y="460" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="980" y="460" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="1010" y="460" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="1040" y="460" width="18" height="22" fill="%234a90e2" opacity="0.8"/><rect x="525" y="120" width="250" height="60" fill="%23ffffff" stroke="%23333" stroke-width="3" rx="8"/><text x="650" y="140" font-family="Arial Black, Arial" font-size="28" font-weight="900" fill="%23333" text-anchor="middle">HANDYED</text><text x="650" y="165" font-family="Arial, sans-serif" font-size="14" font-weight="600" fill="%23666" text-anchor="middle">COMPANY</text></svg>') center/cover;
      margin: 0;
      min-height: 100vh;
      background-attachment: fixed;
      overflow-x: hidden;
    }
    
    .company-banner {
      text-align: center;
      margin-bottom: 20px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .company-banner h1 {
      font-size: clamp(2.5rem, 6vw, 4rem);
      font-weight: 900;
      color: #333;
      margin: 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
      letter-spacing: 3px;
    }
    
    .company-banner .tagline {
      font-size: clamp(1rem, 3vw, 1.5rem);
      color: #667eea;
      margin: 10px 0 0 0;
      font-weight: 600;
      letter-spacing: 1px;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.15);
      backdrop-filter: blur(10px);
    }
    
    .header {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    h2 {
      color: #333;
      margin: 0;
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      font-weight: 300;
    }
    
    .nav-buttons {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .nav-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: 25px;
      cursor: pointer;
      font-size: clamp(14px, 3vw, 16px);
      font-weight: 500;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      min-height: 44px;
      min-width: 44px;
    }
    
    .nav-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    
    .nav-btn:active {
      transform: translateY(0);
    }
    
    .current-time {
      text-align: center;
      margin-bottom: 20px;
      font-size: clamp(14px, 3vw, 18px);
      color: #666;
      background: rgba(102, 126, 234, 0.1);
      padding: 15px;
      border-radius: 10px;
    }
    
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-top: 20px;
    }
    
    .weekday {
      text-align: center;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 10px 5px;
      border-radius: 8px;
      font-size: clamp(10px, 2.5vw, 14px);
    }
    
    .day {
      background: rgba(255, 255, 255, 0.95);
      border: 2px solid #e0e0e0;
      min-height: 120px;
      position: relative;
      border-radius: 8px;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      cursor: pointer;
    }
    
    .day:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      border-color: #667eea;
    }
    
    .day.today {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #667eea;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .day.other-month {
      background: rgba(248, 248, 248, 0.8);
      color: #ccc;
      pointer-events: none;
    }
    
    .day-header {
      padding: 8px;
      border-bottom: 1px solid rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 20px;
    }
    
    .day.today .day-header {
      border-bottom-color: rgba(255,255,255,0.3);
    }
    
    .day-number {
      font-weight: bold;
      font-size: clamp(12px, 3vw, 16px);
    }
    
    .day-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 4px;
      gap: 4px;
      pointer-events: none;
    }
    
    .notes-section {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .note {
      font-size: clamp(10px, 2.5vw, 12px);
      flex: 1;
      resize: none;
      border: none;
      background: rgba(255,255,255,0.9);
      outline: none;
      border-radius: 4px;
      padding: 4px;
      box-sizing: border-box;
      min-height: 40px;
      pointer-events: auto;
    }
    
    .work-section {
      height: auto;
      min-height: 65px;
      display: flex;
      flex-direction: column;
      border-top: 1px solid rgba(0,0,0,0.1);
      background: rgba(0,0,0,0.02);
      padding: 4px;
    }
    
    .day.today .work-section {
      border-top-color: rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.1);
    }
    
    .work-label {
      font-size: clamp(8px, 2vw, 10px);
      font-weight: bold;
      padding: 2px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-align: center;
      margin-bottom: 4px;
    }
    
    .day.today .work-label {
      color: rgba(255,255,255,0.8);
    }
    
    .work-buttons {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }
    
    .work-btn {
      flex: none;
      height: 28px;
      font-size: clamp(9px, 2.2vw, 11px);
      padding: 6px 4px;
      border: 1px solid #ddd;
      background: white;
      color: #666;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
    }
    
    .work-btn:hover {
      background: #f0f0f0;
      border-color: #ccc;
    }
    
    .work-btn:active {
      transform: scale(0.95);
    }
    
    .work-btn.active.work {
      background: #4CAF50;
      color: rgb(181, 248, 155);
      border-color: #45a049;
    }
    
    .work-btn.active.off {
      background: #f44336;
      color: rgb(248, 180, 180);
      border-color: #da190b;
    }
    
    .day.today .work-btn {
      background: rgba(255,255,255,0.9);
      border-color: rgba(255,255,255,0.5);
    }
    
    .day.today .work-btn:hover {
      background: rgba(255,255,255,1);
    }
    
    .day.today .note {
      background: rgba(255,255,255,0.95);
      color: #333;
    }
    
    .month-year {
      color: #667eea;
      font-weight: 400;
    }
    
    .loading {
      text-align: center;
      color: #667eea;
      font-style: italic;
    }

    /* Expanded view styles */
    .expanded-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.95);
      z-index: 1000;
      display: none;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
    }
    
    .expanded-day {
      width: 100%;
      max-width: 500px;
      height: 80vh;
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }
    
    .expanded-day.today-expanded {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: rgb(235, 247, 67);
    }
    
    .expanded-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid #eee;
      padding-bottom: 15px;
    }
    
    .expanded-day.today-expanded .expanded-header {
      border-bottom-color: rgba(255,255,255,0.3);
    }
    
    .expanded-date {
      font-size: 24px;
      font-weight: bold;
    }
    
    .close-btn {
      background: #f44336;
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    
    .close-btn:hover {
      background: #da190b;
      transform: scale(1.1);
    }
    
    .expanded-notes {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .notes-title {
      font-size: 18px;
      font-weight: bold;
    }
    
    .expanded-note {
      flex: 1;
      min-height: 200px;
      padding: 15px;
      border: 2px solid #FFFF00;
      border-radius: 10px;
      font-size: 16px;
      resize: vertical;
      outline: none;
      font-family: inherit;
    }
    
    .expanded-day.today-expanded .expanded-note {
      background: rgba(114, 113, 113, 0.95);
      color: #FFFF00;
      border-color: rgba(255,255,255,0.5);
    }
    
    .expanded-work {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .work-title {
      font-size: 18px;
      font-weight: bold;
    }
    
    .expanded-work-buttons {
      display: flex;
      gap: 15px;
    }
    
    .expanded-work-btn {
      flex: 1;
      height: 50px;
      font-size: 16px;
      border: 2px solid #ddd;
      background: white;
      color: #666;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: bold;
    }
    
    .expanded-work-btn:hover {
      transform: scale(1.05);
    }
    
    .expanded-work-btn.active.work {
      background: #4CAF50;
      color: white;
      border-color: #45a049;
    }
    
    .expanded-work-btn.active.off {
      background: #f44336;
      color: white;
      border-color: #da190b;
    }
    
    .expanded-day.today-expanded .expanded-work-btn {
      background: rgba(182, 180, 180, 0.9);
      border-color: rgba(44, 44, 44, 0.5);
    }
    
    .tap-hint {
      position: absolute;
      bottom: 2px;
      right: 4px;
      font-size: 9px;
      color: #4d2ff3;
      pointer-events: none;
      opacity: 0.7;
    }
    
    .day.today .tap-hint {
      color: rgba(255,255,255,0.7);
    }

    /* Mobile-specific improvements */
    @media (max-width: 768px) {
      body {
        padding: 5px;
      }
      
      .company-banner {
        margin-bottom: 15px;
        padding: 15px;
      }
      
      .company-banner h1 {
        font-size: clamp(2rem, 8vw, 3rem);
      }
      
      .container {
        padding: 10px;
        border-radius: 10px;
      }
      
      .header {
        gap: 10px;
        margin-bottom: 15px;
      }
      
      .nav-buttons {
        gap: 6px;
      }
      
      .nav-btn {
        padding: 10px 12px;
        font-size: 14px;
      }
      
      .calendar {
        gap: 2px;
      }
      
      .weekday {
        padding: 8px 2px;
        font-size: 11px;
      }
      
      .day {
        min-height: 100px;
      }
      
      .work-section {
        min-height: 65px;
      }
      
      .work-btn {
        height: 30px;
        font-size: 11px;
      }
      
      .note {
        min-height: 35px;
        font-size: 11px;
      }
      
      .expanded-overlay {
        padding: 10px;
      }
      
      .expanded-day {
        height: 90vh;
        max-width: none;
      }
    }
    
    @media (max-width: 480px) {
      .company-banner {
        padding: 10px;
      }
      
      .container {
        padding: 8px;
      }
      
      .day {
        min-height: 90px;
      }
      
      .weekday {
        padding: 6px 1px;
        font-size: 10px;
      }
      
      .work-section {
        min-height: 70px;
      }
      
      .work-btn {
        height: 32px;
        font-size: 12px;
        padding: 8px 4px;
      }
      
      .note {
        min-height: 30px;
        font-size: 10px;
      }
      
      .expanded-day {
        padding: 15px;
        height: 95vh;
      }
      
      .expanded-date {
        font-size: 20px;
      }
      
      .expanded-note {
        min-height: 150px;
        font-size: 14px;
      }
      
      .expanded-work-btn {
        height: 45px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>

<div class="company-banner">
  <h1>HANDYED</h1>
  <div class="tagline">Professional Services & Solutions</div>
</div>

<div class="container">
  <div class="header">
    <h2 id="monthYear" class="month-year">Loading...</h2>
    <div class="nav-buttons">
        <button class="nav-btn" onclick="window.location.href='index.html'">HOME</button>


      <button class="nav-btn" onclick="changeMonth(-1)">← Previous</button>
      <button class="nav-btn" onclick="goToToday()">Today</button>
      <button class="nav-btn" onclick="changeMonth(1)">Next →</button>
    </div>
  </div>
  
  <div class="current-time" id="currentTime">
    <div class="loading">Fetching real-time data...</div>
  </div>
  
  <div class="calendar" id="calendar">
    <!-- Weekday headers -->
    <div class="weekday">Mon</div>
    <div class="weekday">Tue</div>
    <div class="weekday">Wed</div>
    <div class="weekday">Thu</div>
    <div class="weekday">Fri</div>
    <div class="weekday">Sat</div>
    <div class="weekday">Sun</div>
  </div>
</div>

<!-- Expanded view overlay -->
<div class="expanded-overlay" id="expandedOverlay">
  <div class="expanded-day" id="expandedDay">
    <div class="expanded-header">
      <div class="expanded-date" id="expandedDate"></div>
      <button class="close-btn" onclick="closeExpanded()">&times;</button>
    </div>
    
    <div class="expanded-notes">
      <div class="notes-title">Notițe:</div>
      <textarea class="expanded-note" id="expandedNote" placeholder="Scrie notițele tale aici..."></textarea>
    </div>
    
    <div class="expanded-work">
      <div class="work-title">Program de lucru:</div>
      <div class="expanded-work-buttons">
        <button class="expanded-work-btn work" id="expandedWorkBtn">Lucru</button>
        <button class="expanded-work-btn off" id="expandedOffBtn">Liber</button>
      </div>
    </div>
  </div>
</div>

<p style="font-size:16px; color:#faf8f8; margin-top:10px;">
  <strong>Note:<br></strong> This calendar can help you keep track of your schedule, but if you change your phone or reset it, you will lose all your data.  
  It does not store anything online or in the cloud — everything is saved only locally on your phone.  
  Your notes and work schedule are completely private; only you can see them.
  <br><br><strong>Nou:</strong>“Tap any day in the calendar to open it full screen and write more easily!”
</p>

<script>
  let currentDate = new Date();
  let displayDate = new Date();
  let utcOffsetMinutes = 0; // from API
  let currentExpandedDay = null;

  // Load saved data from localStorage
  let notes = JSON.parse(localStorage.getItem("notes")) || {};
  let workSchedule = JSON.parse(localStorage.getItem("workSchedule")) || {};

  // Save functions
  function saveNotes() {
    localStorage.setItem("notes", JSON.stringify(notes));
  }
  function saveWorkSchedule() {
    localStorage.setItem("workSchedule", JSON.stringify(workSchedule));
  }

  // Expanded view functions
  function expandDay(day, month, year) {
    currentExpandedDay = { day, month, year };
    const overlay = document.getElementById('expandedOverlay');
    const expandedDayEl = document.getElementById('expandedDay');
    const expandedDate = document.getElementById('expandedDate');
    const expandedNote = document.getElementById('expandedNote');
    const expandedWorkBtn = document.getElementById('expandedWorkBtn');
    const expandedOffBtn = document.getElementById('expandedOffBtn');
    
    // Set date
    const monthNames = ['Ianuarie', 'Februarie', 'Martie', 'Aprilie', 'Mai', 'Iunie',
                        'Iulie', 'August', 'Septembrie', 'Octombrie', 'Noiembrie', 'Decembrie'];
    expandedDate.textContent = `${day} ${monthNames[month]} ${year}`;
    
    // Check if it's today
    const isToday = currentDate.getDate() === day &&
                    currentDate.getMonth() === month &&
                    currentDate.getFullYear() === year;
    if (isToday) {
      expandedDayEl.classList.add('today-expanded');
    } else {
      expandedDayEl.classList.remove('today-expanded');
    }
    
    // Set note content
    const noteKey = `note-${year}-${month}-${day}`;
    expandedNote.value = notes[noteKey] || '';
    
    // Set work schedule
    const workKey = `work-${year}-${month}-${day}`;
    const savedStatus = workSchedule[workKey];
    
    expandedWorkBtn.classList.remove('active');
    expandedOffBtn.classList.remove('active');
    
    if (savedStatus === 'work') expandedWorkBtn.classList.add('active');
    if (savedStatus === 'off') expandedOffBtn.classList.add('active');
    
    // Show overlay
    overlay.style.display = 'flex';
    document.body.style.overflow = 'hidden'; // Prevent background scrolling
    
    // Focus on textarea for immediate typing
    setTimeout(() => {
      expandedNote.focus();
    }, 100);
  }
  
  function closeExpanded() {
    const overlay = document.getElementById('expandedOverlay');
    overlay.style.display = 'none';
    document.body.style.overflow = 'auto'; // Restore scrolling
    currentExpandedDay = null;
  }
  
  // Handle expanded note changes
  document.getElementById('expandedNote').addEventListener('input', function() {
    if (currentExpandedDay) {
      const noteKey = `note-${currentExpandedDay.year}-${currentExpandedDay.month}-${currentExpandedDay.day}`;
      notes[noteKey] = this.value;
      saveNotes();
      
      // Update the calendar view as well
      renderCalendar();
    }
  });
  
  // Handle expanded work buttons
  document.getElementById('expandedWorkBtn').addEventListener('click', function() {
    if (currentExpandedDay) {
      const workKey = `work-${currentExpandedDay.year}-${currentExpandedDay.month}-${currentExpandedDay.day}`;
      const expandedOffBtn = document.getElementById('expandedOffBtn');
      
      if (this.classList.contains('active')) {
        this.classList.remove('active');
        delete workSchedule[workKey];
      } else {
        this.classList.add('active');
        expandedOffBtn.classList.remove('active');
        workSchedule[workKey] = 'work';
      }
      saveWorkSchedule();
      renderCalendar();
    }
  });
  
  document.getElementById('expandedOffBtn').addEventListener('click', function() {
    if (currentExpandedDay) {
      const workKey = `work-${currentExpandedDay.year}-${currentExpandedDay.month}-${currentExpandedDay.day}`;
      const expandedWorkBtn = document.getElementById('expandedWorkBtn');
      
      if (this.classList.contains('active')) {
        this.classList.remove('active');
        delete workSchedule[workKey];
      } else {
        this.classList.add('active');
        expandedWorkBtn.classList.remove('active');
        workSchedule[workKey] = 'off';
      }
      saveWorkSchedule();
      renderCalendar();
    }
  });
  
  // Close expanded view when clicking outside
  document.getElementById('expandedOverlay').addEventListener('click', function(e) {
    if (e.target === this) {
      closeExpanded();
    }
  });
  
  // Close expanded view with Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && currentExpandedDay) {
      closeExpanded();
    }
  });

  // Fetch real-time data from WorldTimeAPI
  async function fetchRealTime() {
    try {
      const response = await fetch('https://worldtimeapi.org/api/timezone/Europe/London');
      const data = await response.json();

      const apiDate = new Date(data.datetime);
      utcOffsetMinutes = data.utc_offset
        ? parseInt(data.utc_offset.slice(1, 3)) * 60 + parseInt(data.utc_offset.slice(4))
        : 0;

      currentDate = apiDate;
      displayDate = new Date(currentDate);

      renderCalendar();
      updateCurrentTimeDisplay();
      setInterval(updateCurrentTimeDisplay, 1000);
    } catch (error) {
      console.error('Failed to fetch real-time data:', error);
      currentDate = new Date();
      displayDate = new Date(currentDate);
      renderCalendar();
      updateCurrentTimeDisplay();
      setInterval(updateCurrentTimeDisplay, 1000);
    }
  }

  function updateCurrentTimeDisplay() {
    const now = new Date(Date.now() + utcOffsetMinutes * 60000 - new Date().getTimezoneOffset() * 60000);
    currentDate = now;

    const options = {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      timeZoneName: 'short'
    };
    document.getElementById('currentTime').innerHTML = `
      <strong>Current Date & Time:</strong><br>
      ${now.toLocaleDateString('en-GB', options)}
    `;
  }

  function renderCalendar() {
    const calendar = document.getElementById('calendar');
    const monthYear = document.getElementById('monthYear');

    // Remove old days
    calendar.querySelectorAll('.day').forEach(day => day.remove());

    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                        'July', 'August', 'September', 'October', 'November', 'December'];
    monthYear.textContent = `${monthNames[displayDate.getMonth()]} ${displayDate.getFullYear()}`;

    const firstDay = new Date(displayDate.getFullYear(), displayDate.getMonth(), 1);
    const lastDay = new Date(displayDate.getFullYear(), displayDate.getMonth() + 1, 0);
    const daysInMonth = lastDay.getDate();

    let startDayOfWeek = firstDay.getDay();
    startDayOfWeek = startDayOfWeek === 0 ? 6 : startDayOfWeek - 1;

    for (let i = 0; i < startDayOfWeek; i++) {
      const emptyDay = document.createElement('div');
      emptyDay.className = 'day other-month';
      calendar.appendChild(emptyDay);
    }

    for (let day = 1; day <= daysInMonth; day++) {
      const dayElement = document.createElement('div');
      dayElement.className = 'day';

      const isToday = currentDate.getDate() === day &&
                      currentDate.getMonth() === displayDate.getMonth() &&
                      currentDate.getFullYear() === displayDate.getFullYear();
      if (isToday) dayElement.classList.add('today');

      const dayHeader = document.createElement('div');
      dayHeader.className = 'day-header';

      const dayNumber = document.createElement('div');
      dayNumber.className = 'day-number';
      dayNumber.textContent = day;
      dayHeader.appendChild(dayNumber);

      const dayContent = document.createElement('div');
      dayContent.className = 'day-content';

      const notesSection = document.createElement('div');
      notesSection.className = 'notes-section';

      const note = document.createElement('textarea');
      note.className = 'note';
      note.placeholder = "Notes...";

      const noteKey = `note-${displayDate.getFullYear()}-${displayDate.getMonth()}-${day}`;
      note.value = notes[noteKey] || '';
      note.addEventListener('input', () => {
        notes[noteKey] = note.value;
        saveNotes();
      });
      notesSection.appendChild(note);

      const workSection = document.createElement('div');
      workSection.className = 'work-section';

      const workLabel = document.createElement('div');
      workLabel.className = 'work-label';
      workLabel.textContent = 'Schedule';

      const workButtons = document.createElement('div');
      workButtons.className = 'work-buttons';

      const workBtn = document.createElement('button');
      workBtn.className = 'work-btn work';
      workBtn.textContent = 'Work';
      workBtn.type = 'button';

      const offBtn = document.createElement('button');
      offBtn.className = 'work-btn off';
      offBtn.textContent = 'Off';
      offBtn.type = 'button';

      const workKey = `work-${displayDate.getFullYear()}-${displayDate.getMonth()}-${day}`;
      const savedStatus = workSchedule[workKey];

      if (savedStatus === 'work') workBtn.classList.add('active');
      if (savedStatus === 'off') offBtn.classList.add('active');

      workBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (workBtn.classList.contains('active')) {
          workBtn.classList.remove('active');
          delete workSchedule[workKey];
        } else {
          workBtn.classList.add('active');
          offBtn.classList.remove('active');
          workSchedule[workKey] = 'work';
        }
        saveWorkSchedule();
      });

      offBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (offBtn.classList.contains('active')) {
          offBtn.classList.remove('active');
          delete workSchedule[workKey];
        } else {
          offBtn.classList.add('active');
          workBtn.classList.remove('active');
          workSchedule[workKey] = 'off';
        }
        saveWorkSchedule();
      });

      // Add tap hint
      const tapHint = document.createElement('div');
      tapHint.className = 'tap-hint';
      tapHint.textContent = 'Tap to expand';

      // Add click event to expand day
      dayElement.addEventListener('click', (e) => {
        // Don't expand if clicking on buttons or textarea
        if (e.target.classList.contains('work-btn') || e.target.classList.contains('note')) {
          return;
        }
        expandDay(day, displayDate.getMonth(), displayDate.getFullYear());
      });

      workButtons.appendChild(workBtn);
      workButtons.appendChild(offBtn);
      workSection.appendChild(workLabel);
      workSection.appendChild(workButtons);

      dayContent.appendChild(notesSection);
      dayContent.appendChild(workSection);

      dayElement.appendChild(dayHeader);
      dayElement.appendChild(dayContent);
      dayElement.appendChild(tapHint);
      calendar.appendChild(dayElement);
    }
  }

  function changeMonth(direction) {
    displayDate.setMonth(displayDate.getMonth() + direction);
    renderCalendar();
  }

  function goToToday() {
    displayDate = new Date(currentDate);
    renderCalendar();
  }

  fetchRealTime();
</script>

</body>
</html>