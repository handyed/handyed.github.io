<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0ea5e9">
    <meta name="description" content="Professional maintenance tracking for nursing homes">
    <link rel="manifest" href="manifest.json"> 
    
    <!-- FIXED FAVICON LINES -->
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16.png">
        <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
        <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
        <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
        <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180.png">
        <link rel="shortcut icon" href="favicon.ico">
    
    <title>NCHM Pro - Maintenance Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .app-container {
            max-width: 768px;
            margin: 0 auto;
            background: #f8fafc;
            min-height: 100vh;
            padding-bottom: 80px;
            box-shadow: 0 0 40px rgba(0,0,0,0.15);
        }

        .header {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(14, 165, 233, 0.3);
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(10px);
        }

        @media (max-width: 640px) {
            .header { padding: 1rem; }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .header h1 {
            font-size: 1.4rem;
            margin-bottom: 0.25rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        @media (max-width: 640px) {
            .header h1 { font-size: 1.2rem; }
        }

        .header p {
            font-size: 0.85rem;
            opacity: 0.95;
            font-weight: 500;
        }

        .menu-btn {
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            padding: 0.6rem;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .menu-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: scale(1.05);
        }

        .menu-btn:active {
            transform: scale(0.95);
        }

        .content {
            padding: 1.5rem;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 640px) {
            .content { padding: 1rem; }
        }

        .page-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }

        @media (max-width: 640px) {
            .page-title { font-size: 1.4rem; }
        }

        .progress-card {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            padding: 1.75rem;
            border-radius: 16px;
            margin-bottom: 1.5rem;
            box-shadow: 0 8px 24px rgba(14, 165, 233, 0.25);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .progress-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(14, 165, 233, 0.3);
        }

        @media (max-width: 640px) {
            .progress-card { padding: 1.25rem; }
        }

        .progress-number {
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -1px;
        }

        @media (max-width: 640px) {
            .progress-number { font-size: 2rem; }
        }

        .progress-bar {
            background: rgba(255,255,255,0.25);
            height: 14px;
            border-radius: 12px;
            overflow: hidden;
            margin: 1rem 0 0.5rem 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            background: white;
            height: 100%;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            padding: 1.5rem;
            border-radius: 16px;
            border: 2px solid;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }

        .stat-card:active {
            transform: translateY(-2px);
        }

        @media (max-width: 640px) {
            .stat-card { padding: 1.25rem; }
        }

        .stat-card.completed {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-color: #6ee7b7;
        }

        .stat-card.remaining {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-color: #fcd34d;
        }

        .area-card {
            background: white;
            padding: 1.5rem;
            border-radius: 16px;
            margin-bottom: 1rem;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .area-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(14, 165, 233, 0.15);
            border-color: #0ea5e9;
        }

        .area-card:active {
            transform: translateY(-2px);
        }

        @media (max-width: 640px) {
            .area-card { padding: 1.25rem; }
        }

        .check-item-card {
            background: white;
            border-radius: 16px;
            margin-bottom: 1.5rem;
            border: 2px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .check-item-card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .check-item-header {
            padding: 1.25rem;
            background: #f8fafc;
            transition: all 0.3s ease;
        }

        .check-item-header.complete {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-left: 5px solid #10b981;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 12px;
            cursor: pointer;
            margin: 0.5rem 0;
            transition: all 0.2s ease;
        }

        .checklist-item:hover {
            background: #f1f5f9;
            transform: translateX(4px);
        }

        .checklist-item:active {
            transform: scale(0.98);
        }

        .checkbox {
            width: 28px;
            height: 28px;
            border: 3px solid #cbd5e0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 16px;
        }

        .checkbox.checked {
            background: #10b981;
            border-color: #10b981;
            color: white;
            animation: checkPop 0.3s ease;
        }

        @keyframes checkPop {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .notes-textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid #cbd5e0;
            border-radius: 12px;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
            margin-top: 0.75rem;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }

        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 1rem;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        @media (max-width: 640px) {
            .btn { padding: 0.75rem 1.25rem; font-size: 0.9rem; }
        }

        .btn-photo {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
            margin-right: 0.5rem;
            border: 2px solid #93c5fd;
        }

        .btn-save {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-top: 2px solid #e2e8f0;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
            max-width: 768px;
            width: 100%;
            display: flex;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.95);
        }

        .nav-btn {
            flex: 1;
            border: none;
            background: none;
            padding: 1rem 0.5rem;
            cursor: pointer;
            color: #64748b;
            font-size: 0.7rem;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .nav-btn:hover {
            background: #f8fafc;
        }

        .nav-btn:active {
            transform: scale(0.95);
        }

        @media (max-width: 640px) {
            .nav-btn {
                padding: 0.75rem 0.25rem;
                font-size: 0.65rem;
            }
            .nav-btn > div:first-child {
                font-size: 1.35rem !important;
            }
        }

        .nav-btn.active {
            color: #0ea5e9;
            background: linear-gradient(to top, rgba(14, 165, 233, 0.1) 0%, transparent 100%);
        }

        .hidden { display: none; }

        .back-btn {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 2px solid #93c5fd;
            color: #1e40af;
            cursor: pointer;
            margin-bottom: 1rem;
            font-size: 1rem;
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            transform: translateX(-4px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        .manager-card {
            background: white;
            border-radius: 16px;
            padding: 1.75rem;
            margin-bottom: 1.25rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .manager-card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }

        @media (max-width: 640px) {
            .manager-card { padding: 1.25rem; }
        }

        .alert-box {
            padding: 1.25rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border-left: 5px solid;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .alert-warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-color: #f59e0b;
        }

        .alert-danger {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-color: #ef4444;
            animation: pulse 2s infinite;
        }

        .alert-success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-color: #10b981;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        @media (max-width: 640px) {
            .calendar-grid { gap: 0.3rem; }
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .calendar-day:hover:not(.header) {
            transform: scale(1.1);
        }

        @media (max-width: 640px) {
            .calendar-day { font-size: 0.75rem; border-radius: 8px; }
        }

        .calendar-day.header {
            background: #f8fafc;
            color: #64748b;
            font-weight: 700;
        }

        .calendar-day.completed {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #059669;
        }

        .calendar-day.partial {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #c2410c;
        }

        .calendar-day.missed {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #dc2626;
        }

        .calendar-day.today {
            border: 3px solid #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
        }

        .performance-meter {
            height: 24px;
            background: #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .performance-fill {
            height: 100%;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .performance-fill.excellent {
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .performance-fill.good {
            background: linear-gradient(90deg, #0ea5e9, #0284c7);
        }

        .performance-fill.warning {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .performance-fill.poor {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 420px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 640px) {
            .modal-content { padding: 1.5rem; width: 95%; }
        }

        .modal-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #cbd5e0;
            border-radius: 12px;
            font-size: 1rem;
            margin: 1rem 0;
            transition: all 0.3s ease;
        }

        .modal-input:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }

        .modal-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        .btn-primary {
            flex: 1;
            padding: 1rem;
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.3);
        }

        .btn-secondary {
            flex: 1;
            padding: 1rem;
            background: #f1f5f9;
            color: #475569;
            border: 2px solid #cbd5e0;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
            transform: translateY(-2px);
        }

        .archive-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .archive-card:hover {
            border-color: #0ea5e9;
            box-shadow: 0 8px 24px rgba(14, 165, 233, 0.2);
            transform: translateY(-4px);
        }

        @media print {
            .no-print { display: none !important; }
            .app-container { max-width: 100%; padding-bottom: 0; }
            .print-only { display: block !important; }
            body { background: white; }
        }

        .print-only { display: none; }

        .install-prompt {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            margin: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
            animation: slideDown 0.5s ease;
        }

        .install-btn {
            background: white;
            color: #0ea5e9;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .install-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(255,255,255,0.3);
        }

        @media (max-width: 640px) {
            #managerTotalPercent { font-size: 2rem !important; }
            #managerCompleted { font-size: 1.3rem !important; }
            #avgDailyCompletion, #onTrack { font-size: 1.4rem !important; }
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #0ea5e9;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .side-menu {
    position: fixed;
    top: 0;
    right: -100%;
    width: 300px;
    height: 100vh;
    background: white;
    box-shadow: -4px 0 20px rgba(0,0,0,0.15);
    z-index: 2000;
    transition: right 0.3s ease;
    overflow-y: auto;
        }

        .side-menu.open {
            right: 0;
        }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
            display: none;
            backdrop-filter: blur(2px);
        }

        .menu-overlay.show {
            display: block;
        }

        .menu-header {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-close {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .menu-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        .menu-item {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .menu-item:hover {
            background: #f8fafc;
            padding-left: 2rem;
        }

        .menu-item-icon {
            font-size: 1.5rem;
            width: 32px;
        }

        .menu-item-text {
            flex: 1;
        }

        .menu-item-title {
            font-weight: 700;
            color: #0f172a;
            font-size: 1rem;
        }

        .menu-item-desc {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 0.25rem;
        }






    </style>
</head>
<body>
    <div id="installPrompt" class="install-prompt hidden">
        <div>
            <div style="font-weight: 700; margin-bottom: 0.25rem;">üì± Install NCHM Pro</div>
            <div style="font-size: 0.85rem; opacity: 0.95;">Add to home screen for easy access</div>
        </div>
        <button class="install-btn" onclick="installApp()">Install</button>
    </div>

    <div id="maintenanceInfo" style="background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color: white; padding: 15px; text-align: center; margin-bottom: 0; border-radius: 0;">
        <h3 style="margin: 0; font-size: 18px; font-weight: 700;">Maintenance Technician: <span id="technicianName">Loading...</span></h3>
        <p style="margin: 5px 0 0 0; font-size: 12px; opacity: 0.95;" id="loginTime"></p>
    </div>
    
    <div class="app-container">
        <div class="header no-print">
            <div class="header-content">
                <div>
                    <h1>üè• NCHM Pro</h1>
                    <p>Professional Maintenance Tracker</p>
                </div>
                <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
            </div>
        </div>

        <div id="dashboardView" class="content">
            <h1 class="page-title">Today's Checks</h1>
            <p style="color: #64748b; margin-bottom: 1.5rem; font-weight: 500;">Monday, October 06, 2025</p>

            <div class="progress-card">
                <p style="opacity: 0.95; font-size: 0.9rem; font-weight: 600;">Daily Progress</p>
                <p class="progress-number"><span id="completedCount">0</span>/<span id="totalCount">25</span></p>
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                </div>
                <p style="font-size: 0.9rem; opacity: 0.95; font-weight: 600;"><span id="progressPercent">0</span>% Complete</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card completed">
                    <div style="font-size: 1.75rem; margin-bottom: 0.5rem;">‚úì</div>
                    <p style="font-size: 2rem; font-weight: 800; color: #059669;" id="completedStat">0</p>
                    <p style="font-size: 0.9rem; color: #10b981; font-weight: 600;">Completed</p>
                </div>
                <div class="stat-card remaining">
                    <div style="font-size: 1.75rem; margin-bottom: 0.5rem;">‚è∞</div>
                    <p style="font-size: 2rem; font-weight: 800; color: #d97706;" id="remainingStat">25</p>
                    <p style="font-size: 0.9rem; color: #f59e0b; font-weight: 600;">Remaining</p>
                </div>
            </div>

            <h2 style="font-size: 1.2rem; font-weight: 700; margin-bottom: 1rem; color: #0f172a;">Areas to Check</h2>
            <div id="areasContainer"></div>
        </div>

        <div id="checklistView" class="content hidden">
            <button class="back-btn" onclick="showDashboard()">‚Üê Back to Dashboard</button>
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                <span id="areaIconLarge" style="font-size: 3rem;"></span>
                <h1 class="page-title" id="areaTitle" style="margin: 0;"></h1>
            </div>
            <p style="color: #64748b; margin-bottom: 1.5rem; font-weight: 500;" id="areaItemCount"></p>
            <div id="checkItemsContainer"></div>
        </div>

        <div id="reportsView" class="content hidden">
            <h1 class="page-title">Reports</h1>
            <div class="manager-card">
                <h2 style="font-size: 1.2rem; font-weight: 700; margin-bottom: 1rem; color: #0f172a;">Today's Summary</h2>
                <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 2px solid #f1f5f9;">
                    <span style="font-weight: 600; color: #64748b;">Total Checks</span>
                    <span style="font-weight: 700; color: #0f172a;" id="reportTotal">25</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 2px solid #f1f5f9;">
                    <span style="font-weight: 600; color: #64748b;">Completed</span>
                    <span style="font-weight: 700; color: #10b981;" id="reportCompleted">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 0.75rem 0;">
                    <span style="font-weight: 600; color: #64748b;">Completion Rate</span>
                    <span style="font-weight: 700; color: #0ea5e9;" id="reportPercent">0%</span>
                </div>
            </div>
        </div>

        <div id="managerView" class="content hidden">
            <h1 class="page-title">Manager Dashboard</h1>
            <p style="color: #64748b; margin-bottom: 1.5rem; font-weight: 500;">Performance Overview</p>

            <div id="alertSection"></div>

            <div class="manager-card">
                <h2 style="font-size: 1.2rem; font-weight: 700; margin-bottom: 1rem; color: #0f172a;">Overall Performance</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <div>
                        <div style="font-size: 3rem; font-weight: 800; color: #0ea5e9;" id="managerTotalPercent">0%</div>
                        <div style="color: #64748b; font-size: 0.9rem; font-weight: 600;">Completion Rate</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.75rem; font-weight: 800; color: #10b981;" id="managerCompleted">0</div>
                        <div style="color: #64748b; font-size: 0.9rem; font-weight: 600;">of <span id="managerTotal">25</span> items</div>
                    </div>
                </div>
                <div class="performance-meter">
                    <div id="performanceFill" class="performance-fill excellent" style="width: 0%"></div>
                </div>
            </div>

            <div class="manager-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2 style="font-size: 1.2rem; font-weight: 700; color: #0f172a;">October 2025</h2>
                    <div style="font-size: 0.9rem; color: #64748b; font-weight: 600;">
                        Days Left: <span id="daysRemaining" style="font-weight: 800; color: #0ea5e9;">25</span>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
                <div style="display: flex; gap: 1rem; margin-top: 1rem; font-size: 0.85rem; flex-wrap: wrap; font-weight: 600;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="width: 18px; height: 18px; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border-radius: 6px;"></div>
                        <span>Complete</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="width: 18px; height: 18px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 6px;"></div>
                        <span>Partial</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="width: 18px; height: 18px; background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border-radius: 6px;"></div>
                        <span>Missed</span>
                    </div>
                </div>
            </div>

            <div class="manager-card">
                <h2 style="font-size: 1.2rem; font-weight: 700; margin-bottom: 1rem; color: #0f172a;">Progress by Area</h2>
                <div id="areasProgressContainer"></div>
            </div>

            <div class="manager-card">
                <h2 style="font-size: 1.2rem; font-weight: 700; margin-bottom: 1rem; color: #0f172a;">Performance Metrics</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div style="text-align: center; padding: 1.5rem; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border-radius: 12px;">
                        <div style="font-size: 2rem; font-weight: 800; color: #059669;" id="avgDailyCompletion">0%</div>
                        <div style="font-size: 0.85rem; color: #047857; margin-top: 0.25rem; font-weight: 600;">Avg Daily Rate</div>
                    </div>
                    <div style="text-align: center; padding: 1.5rem; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-radius: 12px;">
                        <div style="font-size: 2rem; font-weight: 800; color: #0284c7;" id="onTrack">Yes</div>
                        <div style="font-size: 0.85rem; color: #0369a1; margin-top: 0.25rem; font-weight: 600;">On Track</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="archiveView" class="content hidden">
            <h1 class="page-title">Monthly Archives</h1>
            <p style="color: #64748b; margin-bottom: 1.5rem; font-weight: 500;">View and print past records</p>
            
            <button class="btn btn-primary" onclick="archiveCurrentMonth()" style="margin-bottom: 1rem; width: 100%;">
                üì¶ Archive Current Month
            </button>

            <button class="btn btn-primary" onclick="showPhotoArchive()" style="margin-bottom: 1.5rem; width: 100%; background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                üì∑ View Photo Archive
            </button>

            <div id="archivesContainer"></div>
        </div>

        <div id="printView" class="content hidden">
            <div class="no-print">
                <button class="back-btn" onclick="showView('archive')">‚Üê Back to Archives</button>
            </div>
            
            <div style="background: white; padding: 2rem; border-radius: 16px;">
                <div class="print-only" style="text-align: center; margin-bottom: 2rem;">
                    <h1 style="color: #0ea5e9; font-weight: 800;">üè• NCHM Pro</h1>
                    <p style="font-weight: 600;">Maintenance Records</p>
                </div>

                <div id="printContent"></div>

                <div class="no-print" style="margin-top: 2rem;">
                    <button class="btn btn-primary" onclick="window.print()" style="width: 100%;">
                        üñ®Ô∏è Print Report
                    </button>
                </div>
            </div>
        </div>

        <div id="passwordModal" class="modal">
            <div class="modal-content">
                <h2 style="font-size: 1.4rem; font-weight: 700; margin-bottom: 0.5rem; color: #0f172a;">Password Required</h2>
                <p style="color: #64748b; font-size: 0.95rem; font-weight: 500;">Enter password to uncheck this item</p>
                <input type="password" id="passwordInput" class="modal-input" placeholder="Enter password">
                <div class="modal-buttons">
                    <button class="btn-secondary" onclick="closePasswordModal()">Cancel</button>
                    <button class="btn-primary" onclick="verifyPassword()">Confirm</button>
                </div>
            </div>
        </div>

        <div id="managerPasswordModal" class="modal">
            <div class="modal-content">
                <h2 style="font-size: 1.4rem; font-weight: 700; margin-bottom: 0.5rem; color: #0f172a;">Manager Access</h2>
                <p style="color: #64748b; font-size: 0.95rem; font-weight: 500;">Enter manager password to continue</p>
                <input type="password" id="managerPasswordInput" class="modal-input" placeholder="Enter manager password">
                <div id="managerErrorMsg" style="color: #ef4444; font-size: 0.95rem; margin-top: 0.5rem; display: none; font-weight: 600;">‚ùå Incorrect password!</div>
                <div class="modal-buttons">
                    <button class="btn-secondary" onclick="closeManagerPasswordModal()">Cancel</button>
                    <button class="btn-primary" onclick="verifyManagerPassword()">Access</button>
                </div>
            </div>
        </div>
                <!-- Side Menu -->
        <div class="menu-overlay" id="menuOverlay" onclick="closeMenu()"></div>
        <div class="side-menu" id="sideMenu">
            <div class="menu-header">
                <div>
                    <h2 style="font-size: 1.3rem; font-weight: 800; margin-bottom: 0.25rem;">Menu</h2>
                    <p style="font-size: 0.85rem; opacity: 0.95;">Settings & Options</p>
                </div>
                <button class="menu-close" onclick="closeMenu()">‚úï</button>
            </div>

            <div class="menu-item" onclick="showChangePassword()">
                <div class="menu-item-icon">üîê</div>
                <div class="menu-item-text">
                    <div class="menu-item-title">Change Passwords</div>
                    <div class="menu-item-desc">Update manager & uncheck passwords</div>
                </div>
            </div>

            <div class="menu-item" onclick="showHelp()">
                <div class="menu-item-icon">‚ùì</div>
                <div class="menu-item-text">
                    <div class="menu-item-title">Help & Instructions</div>
                    <div class="menu-item-desc">How to use this app</div>
                </div>
            </div>

            <div class="menu-item" onclick="exportData()">
                <div class="menu-item-icon">üì•</div>
                <div class="menu-item-text">
                    <div class="menu-item-title">Export Data</div>
                    <div class="menu-item-desc">Download backup as JSON</div>
                </div>
            </div>

            <div class="menu-item" onclick="importData()">
                <div class="menu-item-icon">üì§</div>
                <div class="menu-item-text">
                    <div class="menu-item-title">Import Data</div>
                    <div class="menu-item-desc">Restore from backup file</div>
                </div>
            </div>

            <div class="menu-item" onclick="showAbout()">
                <div class="menu-item-icon">‚ÑπÔ∏è</div>
                <div class="menu-item-text">
                    <div class="menu-item-title">About</div>
                    <div class="menu-item-desc">App version & information</div>
                </div>
            </div>

            <div class="menu-item" onclick="clearAllData()" style="border-bottom: none;">
                <div class="menu-item-icon">üóëÔ∏è</div>
                <div class="menu-item-text">
                    <div class="menu-item-title" style="color: #ef4444;">Clear All Data</div>
                    <div class="menu-item-desc">Reset app to default state</div>
                </div>
            </div>
        </div>

        <div class="bottom-nav no-print">
            <button class="nav-btn" onclick="showView('dashboard')">
                <div style="font-size: 1.5rem;">üè†</div>
                <div>Home</div>
            </button>
            
            <button class="nav-btn" onclick="showView('checklist')">
                <div style="font-size: 1.5rem;">üìù</div>
                <div>Checks</div>
            </button>
            <button class="nav-btn" onclick="showView('reports')">
                <div style="font-size: 1.5rem;">üìä</div>
                <div>Reports</div>
            </button>
            <button class="nav-btn" onclick="showManagerPasswordModal()">
                <div style="font-size: 1.5rem;">üëî</div>
                <div>Manager</div>
            </button>
            <button class="nav-btn" onclick="showView('archive')">
                <div style="font-size: 1.5rem;">üì¶</div>
                <div>Archive</div>
            </button>
        </div>
    </div>

    <script>
        // PWA Installation
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').classList.remove('hidden');
        });

                function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('App installed');
                    }
                    deferredPrompt = null;
                    document.getElementById('installPrompt').classList.add('hidden');
                });
            } else {
                // Show manual installation instructions
                showManualInstallInstructions();
            }
        }

        function showManualInstallInstructions() {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2 style="font-size: 1.4rem; font-weight: 700; margin-bottom: 1rem; color: #0f172a;">üì± Install NCHM Pro</h2>
                    
                    <div style="background: #dbeafe; padding: 1rem; border-radius: 12px; margin-bottom: 1rem; border-left: 4px solid #0ea5e9;">
                        <p style="font-size: 0.95rem; color: #1e40af; font-weight: 600; margin-bottom: 0.5rem;">
                            To install this app on your device:
                        </p>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 1.25rem; border-radius: 12px; margin-bottom: 1rem;">
                        <h3 style="font-weight: 700; color: #0f172a; margin-bottom: 0.75rem;">üì± On iPhone/iPad:</h3>
                        <ol style="margin-left: 1.25rem; color: #475569; font-size: 0.95rem; line-height: 1.6;">
                            <li>Tap the <strong>Share</strong> button (square with arrow)</li>
                            <li>Scroll down and tap <strong>"Add to Home Screen"</strong></li>
                            <li>Tap <strong>"Add"</strong> to confirm</li>
                        </ol>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 1.25rem; border-radius: 12px; margin-bottom: 1rem;">
                        <h3 style="font-weight: 700; color: #0f172a; margin-bottom: 0.75rem;">ü§ñ On Android:</h3>
                        <ol style="margin-left: 1.25rem; color: #475569; font-size: 0.95rem; line-height: 1.6;">
                            <li>Tap the <strong>menu</strong> (three dots) in browser</li>
                            <li>Tap <strong>"Add to Home screen"</strong> or <strong>"Install app"</strong></li>
                            <li>Tap <strong>"Add"</strong> or <strong>"Install"</strong> to confirm</li>
                        </ol>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 1.25rem; border-radius: 12px; margin-bottom: 1.5rem;">
                        <h3 style="font-weight: 700; color: #0f172a; margin-bottom: 0.75rem;">üíª On Desktop:</h3>
                        <ol style="margin-left: 1.25rem; color: #475569; font-size: 0.95rem; line-height: 1.6;">
                            <li>Look for an <strong>install icon</strong> in the address bar</li>
                            <li>Or use browser menu ‚Üí <strong>"Install NCHM Pro"</strong></li>
                            <li>Click <strong>"Install"</strong> to confirm</li>
                        </ol>
                    </div>
                    
                    <button class="btn-primary" onclick="this.closest('.modal').remove()" style="width: 100%;">Got it!</button>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Hide the install prompt banner
            document.getElementById('installPrompt').classList.add('hidden');
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(() => {
                console.log('Service Worker registered');
            }).catch((error) => {
                console.log('Service Worker registration failed:', error);
            });
        }

        // Initialize photo archive
        if (!window.photoArchive) window.photoArchive = [];

        const areas = [
            { id: 'rooms', name: 'Resident Rooms', icon: 'üõèÔ∏è', items: ['Room 101', 'Room 102', 'Room 103', 'Room 104', 'Room 105'] },
            { id: 'corridors', name: 'Corridors', icon: 'üö™', items: ['Ground Floor Corridor', 'First Floor Corridor', 'Second Floor Corridor'] },
            { id: 'equipment', name: 'Air Mattresses', icon: 'üõå', items: ['Room 101 Mattress', 'Room 102 Mattress', 'Room 103 Mattress', 'Room 104 Mattress'] },
            { id: 'safety', name: 'Safety Equipment', icon: 'üî•', items: ['Fire Extinguishers', 'Emergency Lighting', 'Smoke Detectors', 'Exit Signs'] },
            { id: 'bathrooms', name: 'Bathrooms', icon: 'üöø', items: ['Ground Floor Bathroom', 'First Floor Bathroom', 'Second Floor Bathroom'] },
            { id: 'kitchen', name: 'Kitchen', icon: 'üç≥', items: ['Kitchen Equipment', 'Refrigeration', 'Food Storage Areas'] }
        ];

        const checkItemsByArea = {
            'rooms': [
                'General condition good',
                'Wardrobe checked',
                'Bed checked',
                'Air mattress/Foam mattress',
                'Radiator working',
                'Sockets functioning',
                'Light working',
                'Window secure',
                'Door functioning',
                'Curtains checked',
                'Smoke detector',
                'Call bell working'
            ],
            'default': ['General condition good', 'No visible damage', 'Clean and tidy', 'Equipment functioning', 'Safety standards met', 'No hazards present']
        };

        // Load from localStorage
        let checks = JSON.parse(localStorage.getItem('nchmChecks')) || {};
        let notes = JSON.parse(localStorage.getItem('nchmNotes')) || {};
        let photos = JSON.parse(localStorage.getItem('nchmPhotos')) || {};
        let waterTemperatures = JSON.parse(localStorage.getItem('nchmWaterTemp')) || {};
        let monthlyArchives = JSON.parse(localStorage.getItem('nchmArchives')) || [];
        let selectedArea = null;
        let pendingUncheck = null;
        const UNCHECK_PASSWORD = 'manager123';
        const MANAGER_PASSWORD = 'manager123';

        // Save to localStorage
        function saveData() {
            localStorage.setItem('nchmChecks', JSON.stringify(checks));
            localStorage.setItem('nchmNotes', JSON.stringify(notes));
            localStorage.setItem('nchmPhotos', JSON.stringify(photos));
            localStorage.setItem('nchmWaterTemp', JSON.stringify(waterTemperatures));
            localStorage.setItem('nchmArchives', JSON.stringify(monthlyArchives));
        }

        function init() {
            renderAreas();
            updateStats();
            
            // Load technician info
            const maintenanceName = localStorage.getItem('maintenanceName') || 'Demo User';
            const loginTime = localStorage.getItem('loginTime');
            
            document.getElementById('technicianName').textContent = maintenanceName;
            
            if (loginTime) {
                const date = new Date(loginTime);
                document.getElementById('loginTime').textContent = 
                    'Logged in: ' + date.toLocaleDateString() + ' at ' + date.toLocaleTimeString();
            }
        }

        function showView(view) {
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('checklistView').classList.add('hidden');
            document.getElementById('reportsView').classList.add('hidden');
            document.getElementById('managerView').classList.add('hidden');
            document.getElementById('archiveView').classList.add('hidden');
            document.getElementById('printView').classList.add('hidden');

            if (view === 'dashboard') {
                document.getElementById('dashboardView').classList.remove('hidden');
            } else if (view === 'checklist') {
                if (selectedArea) {
                    document.getElementById('checklistView').classList.remove('hidden');
                } else {
                    document.getElementById('dashboardView').classList.remove('hidden');
                }
            } else if (view === 'reports') {
                document.getElementById('reportsView').classList.remove('hidden');
            } else if (view === 'manager') {
                document.getElementById('managerView').classList.remove('hidden');
                updateManagerDashboard();
            } else if (view === 'archive') {
                document.getElementById('archiveView').classList.remove('hidden');
                loadArchives();
            } else if (view === 'print') {
                document.getElementById('printView').classList.remove('hidden');
            }

            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const btns = document.querySelectorAll('.nav-btn');
            const btnIndex = view === 'dashboard' ? 0 : view === 'checklist' ? 1 : view === 'reports' ? 2 : view === 'manager' ? 3 : 4;
            if (btns[btnIndex]) btns[btnIndex].classList.add('active');

            updateStats();
        }

        function renderAreas() {
            const container = document.getElementById('areasContainer');
            container.innerHTML = '';

            areas.forEach(area => {
                const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                const areaChecks = Object.keys(checks).filter(k => k.startsWith(area.id + '-')).filter(k => checks[k]);
                const areaTotal = area.items.length * currentCheckItems.length;
                const areaPercentage = areaTotal > 0 ? Math.round((areaChecks.length / areaTotal) * 100) : 0;

                const card = document.createElement('div');
                card.className = 'area-card';
                card.onclick = () => selectArea(area);
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="font-size: 2.5rem;">${area.icon}</div>
                            <div>
                                <div style="font-weight: 700; color: #0f172a; font-size: 1.05rem;">${area.name}</div>
                                <div style="font-size: 0.9rem; color: #64748b; font-weight: 500;">${area.items.length} items</div>
                            </div>
                        </div>
                        <div style="font-size: 1.75rem; font-weight: 800; color: ${areaPercentage === 100 ? '#10b981' : '#cbd5e0'};">${areaPercentage}%</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function selectArea(area) {
            selectedArea = area;
            document.getElementById('areaIconLarge').textContent = area.icon;
            document.getElementById('areaTitle').textContent = area.name;
            document.getElementById('areaItemCount').textContent = area.items.length + ' items to check';
            renderCheckItems();
            showView('checklist');
        }

        function renderCheckItems() {
            const container = document.getElementById('checkItemsContainer');
            container.innerHTML = '';
            const currentCheckItems = checkItemsByArea[selectedArea.id] || checkItemsByArea['default'];

            selectedArea.items.forEach((item) => {
                const itemKey = selectedArea.id + '-' + item;
                const itemChecks = currentCheckItems.filter(ci => checks[itemKey + '-' + ci]);
                const isComplete = itemChecks.length === currentCheckItems.length;

                const card = document.createElement('div');
                card.className = 'check-item-card';
                
                let checklistHTML = currentCheckItems.map((checkItem) => {
                    const checkKey = itemKey + '-' + checkItem;
                    const isChecked = checks[checkKey];
                    return `
                        <div class="checklist-item" onclick="toggleCheck('${selectedArea.id}', '${item}', '${checkItem}')">
                            <div class="checkbox ${isChecked ? 'checked' : ''}">
                                ${isChecked ? '‚úì' : ''}
                            </div>
                            <div style="color: ${isChecked ? '#0f172a' : '#64748b'}; font-weight: 500;">${checkItem}</div>
                        </div>
                    `;
                }).join('');

                let waterTempHTML = '';
                if (selectedArea.id === 'rooms') {
                    const tempKey = itemKey + '-waterTemp';
                    const currentTemp = waterTemperatures[tempKey] || 40;
                    waterTempHTML = `
                        <div style="margin-top: 1rem; padding: 1.25rem; background: #f8fafc; border-radius: 12px; border: 2px solid #e2e8f0;">
                            <label style="font-size: 0.95rem; font-weight: 600; color: #475569; display: block; margin-bottom: 0.75rem;">
                                üå°Ô∏è Water Temperature (¬∞C)
                            </label>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <input type="range" min="30" max="50" value="${currentTemp}" 
                                       style="flex: 1;" 
                                       oninput="updateWaterTemp('${itemKey}', this.value)">
                                <div style="font-size: 1.4rem; font-weight: 800; color: #0ea5e9; min-width: 70px;">
                                    <span id="temp-${itemKey}">${currentTemp}</span>¬∞C
                                </div>
                            </div>
                        </div>
                    `;
                }

                card.innerHTML = `
                    <div class="check-item-header ${isComplete ? 'complete' : ''}">
                        <div style="font-weight: 700; color: #0f172a; font-size: 1.05rem;">${item}</div>
                        ${isComplete ? '<div style="color: #10b981; font-size: 0.9rem; margin-top: 0.3rem; font-weight: 600;">‚úì Complete</div>' : ''}
                    </div>
                    <div style="padding: 1.25rem;">
                        ${checklistHTML}
                        ${waterTempHTML}
                        <div style="margin-top: 1.25rem; padding-top: 1.25rem; border-top: 2px solid #f1f5f9;">
                            <label style="font-size: 0.95rem; font-weight: 600; color: #475569;">Notes (optional)</label>
                            <textarea class="notes-textarea" placeholder="Add any notes or issues found..." onchange="saveNote('${selectedArea.id}', '${item}', this.value)">${notes[itemKey] || ''}</textarea>
                        </div>
                        <button class="btn btn-photo" onclick="addPhoto('${selectedArea.id}', '${item}')">
                            üì∑ Add Photo ${photos[itemKey] ? '(' + photos[itemKey] + ')' : ''}
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function toggleCheck(areaId, item, checkItem) {
            const key = areaId + '-' + item + '-' + checkItem;
            
            if (checks[key]) {
                pendingUncheck = key;
                document.getElementById('passwordModal').classList.add('show');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
                return;
            }
            
            checks[key] = true;
            saveData();
            updateStats();
            renderCheckItems();
            renderAreas();
            
            if (!document.getElementById('managerView').classList.contains('hidden')) {
                updateManagerDashboard();
            }
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('show');
            pendingUncheck = null;
            document.getElementById('passwordInput').value = '';
        }

        function verifyPassword() {
            const inputPassword = document.getElementById('passwordInput').value;
            
            if (inputPassword === UNCHECK_PASSWORD) {
                if (pendingUncheck) {
                    checks[pendingUncheck] = false;
                    saveData();
                    updateStats();
                    renderCheckItems();
                    renderAreas();
                    
                    if (!document.getElementById('managerView').classList.contains('hidden')) {
                        updateManagerDashboard();
                    }
                }
                closePasswordModal();
            } else {
                alert('‚ùå Incorrect password! Cannot uncheck item.');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        function saveNote(areaId, item, value) {
            notes[areaId + '-' + item] = value;
            saveData();
        }

        function addPhoto(areaId, item) {
            const key = areaId + '-' + item;
            
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            
            if (isMobile) {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.capture = 'camera';
                
                input.onchange = function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        
                        reader.onload = function(event) {
                            if (!window.photoArchive) window.photoArchive = [];
                            
                            window.photoArchive.push({
                                key: key,
                                data: event.target.result,
                                timestamp: new Date().toISOString(),
                                date: new Date().toLocaleDateString(),
                                time: new Date().toLocaleTimeString()
                            });
                            
                            photos[key] = (photos[key] || 0) + 1;
                            saveData();
                            renderCheckItems();
                            alert('‚úÖ Photo saved! Total: ' + window.photoArchive.length);
                        };
                        
                        reader.onerror = function() {
                            alert('‚ùå Error saving photo');
                        };
                        
                        reader.readAsDataURL(file);
                    }
                };
                
                input.click();
            } else {
                openWebcam(key);
            }
        }

        function openWebcam(key) {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <h2 style="margin-bottom: 1rem; font-weight: 700; color: #0f172a;">Take Photo</h2>
                    <video id="webcamVideo" autoplay style="width: 100%; border-radius: 12px; background: #000;"></video>
                    <canvas id="photoCanvas" style="display: none;"></canvas>
                    <div style="display: flex; gap: 0.75rem; margin-top: 1rem;">
                        <button class="btn-primary" onclick="capturePhoto('${key}')" style="flex: 1;">
                            üì∑ Capture
                        </button>
                        <button class="btn-secondary" onclick="closeWebcam()" style="flex: 1;">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    window.currentStream = stream;
                    document.getElementById('webcamVideo').srcObject = stream;
                })
                .catch(err => {
                    alert('‚ùå Camera access denied or not available');
                    closeWebcam();
                });
        }

        function capturePhoto(key) {
            const video = document.getElementById('webcamVideo');
            const canvas = document.getElementById('photoCanvas');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            
            const photoData = canvas.toDataURL('image/jpeg', 0.8);
            
            if (!window.photoArchive) window.photoArchive = [];
            window.photoArchive.push({
                key: key,
                data: photoData,
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString()
            });
            
            photos[key] = (photos[key] || 0) + 1;
            saveData();
            renderCheckItems();
            closeWebcam();
            alert('‚úÖ Photo saved to archive!');
        }

        function closeWebcam() {
            if (window.currentStream) {
                window.currentStream.getTracks().forEach(track => track.stop());
            }
            const modal = document.querySelector('.modal.show');
            if (modal) modal.remove();
        }

        function showPhotoArchive() {
            if (!window.photoArchive || window.photoArchive.length === 0) {
                alert('üì∑ No photos in archive yet. Take some photos first!');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.style.cssText = 'display: flex !important; overflow-y: auto;';
            
            let photosHTML = '';
            for (let i = 0; i < window.photoArchive.length; i++) {
                const photo = window.photoArchive[i];
                photosHTML += `
                    <div style="margin-bottom: 1.5rem; border: 2px solid #e2e8f0; border-radius: 16px; padding: 1rem; background: white; transition: all 0.3s ease;">
                        <img src="${photo.data}" style="width: 100%; border-radius: 12px; margin-bottom: 0.75rem; display: block;">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem;">
                            <div style="flex: 1; min-width: 150px;">
                                <p style="font-weight: 700; color: #0f172a; margin-bottom: 0.25rem;">Photo ${i + 1}</p>
                                <p style="font-size: 0.85rem; color: #64748b; font-weight: 500;">${photo.date} ‚Ä¢ ${photo.time}</p>
                            </div>
                            <button onclick="deletePhoto(${i}); event.stopPropagation();" style="padding: 0.6rem 1.25rem; background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color: #dc2626; border: 2px solid #fca5a5; border-radius: 8px; cursor: pointer; font-weight: 700; transition: all 0.3s ease;">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </div>
                `;
            }
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px; width: 95%; max-height: 90vh; overflow-y: auto;">
                    <div style="position: sticky; top: 0; background: white; padding-bottom: 1rem; margin-bottom: 1rem; border-bottom: 2px solid #e2e8f0; z-index: 10;">
                        <h2 style="font-size: 1.5rem; font-weight: 800; margin-bottom: 0.5rem; color: #0f172a;">üì∑ Photo Archive</h2>
                        <p style="color: #64748b; font-size: 0.95rem; font-weight: 500;">Total Photos: ${window.photoArchive.length}</p>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        ${photosHTML}
                    </div>
                    
                    <button onclick="closePhotoArchive()" class="btn-secondary" style="width: 100%; padding: 1rem; font-weight: 700;">
                        Close
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function closePhotoArchive() {
            const modal = document.querySelector('.modal.show');
            if (modal) modal.remove();
        }

        function deletePhoto(index) {
            if (confirm('Delete this photo?')) {
                window.photoArchive.splice(index, 1);
                closePhotoArchive();
                
                if (window.photoArchive.length > 0) {
                    setTimeout(() => showPhotoArchive(), 100);
                } else {
                    alert('üì∑ All photos deleted!');
                }
            }
        }

        function updateWaterTemp(itemKey, value) {
            waterTemperatures[itemKey + '-waterTemp'] = value;
            document.getElementById('temp-' + itemKey).textContent = value;
            saveData();
        }

        function updateStats() {
            let totalChecks = 0;
            areas.forEach(area => {
                const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                totalChecks += area.items.length * currentCheckItems.length;
            });

            const completedChecks = Object.keys(checks).filter(key => checks[key]).length;
            const percentage = totalChecks > 0 ? Math.round((completedChecks / totalChecks) * 100) : 0;

            let completedItems = 0;
            areas.forEach(area => {
                const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                area.items.forEach(item => {
                    const itemKey = area.id + '-' + item;
                    const itemChecks = currentCheckItems.filter(ci => checks[itemKey + '-' + ci]);
                    if (itemChecks.length === currentCheckItems.length) {
                        completedItems++;
                    }
                });
            });

            const totalItems = areas.reduce((sum, area) => sum + area.items.length, 0);

            document.getElementById('completedCount').textContent = completedItems;
            document.getElementById('totalCount').textContent = totalItems;
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressPercent').textContent = percentage;
            document.getElementById('completedStat').textContent = completedItems;
            document.getElementById('remainingStat').textContent = totalItems - completedItems;
            document.getElementById('reportTotal').textContent = totalItems;
            document.getElementById('reportCompleted').textContent = completedItems;
            document.getElementById('reportPercent').textContent = percentage + '%';
            
            if (!document.getElementById('managerView').classList.contains('hidden')) {
                updateManagerDashboard();
            }
        }

        function showDashboard() {
            showView('dashboard');
        }

        function toggleMenu() {
    document.getElementById('sideMenu').classList.add('open');
    document.getElementById('menuOverlay').classList.add('show');
}

function closeMenu() {
    document.getElementById('sideMenu').classList.remove('open');
    document.getElementById('menuOverlay').classList.remove('show');
}

function showChangePassword() {
    closeMenu();
    const modal = document.createElement('div');
    modal.className = 'modal show';
    modal.innerHTML = `
        <div class="modal-content">
            <h2 style="font-size: 1.4rem; font-weight: 700; margin-bottom: 1rem; color: #0f172a;">Change Passwords</h2>
            
            <label style="font-weight: 600; color: #475569; font-size: 0.95rem;">Manager Password</label>
            <input type="password" id="newManagerPass" class="modal-input" placeholder="Enter new manager password" style="margin-bottom: 1rem;">
            
            <label style="font-weight: 600; color: #475569; font-size: 0.95rem;">Uncheck Password</label>
            <input type="password" id="newUncheckPass" class="modal-input" placeholder="Enter new uncheck password">
            
            <div style="background: #fef3c7; padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid #f59e0b;">
                <p style="font-size: 0.9rem; color: #92400e; font-weight: 600;">
                    ‚ö†Ô∏è Remember your new passwords! They cannot be recovered.
                </p>
            </div>
            
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                <button class="btn-primary" onclick="saveNewPasswords()">Save Changes</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function saveNewPasswords() {
    const managerPass = document.getElementById('newManagerPass').value;
    const uncheckPass = document.getElementById('newUncheckPass').value;
    
    if (managerPass) {
        localStorage.setItem('MANAGER_PASSWORD', managerPass);
        MANAGER_PASSWORD = managerPass;
    }
    
    if (uncheckPass) {
        localStorage.setItem('UNCHECK_PASSWORD', uncheckPass);
        UNCHECK_PASSWORD = uncheckPass;
    }
    
    if (managerPass || uncheckPass) {
        alert('‚úÖ Passwords updated successfully!');
        document.querySelector('.modal').remove();
    } else {
        alert('‚ùå Please enter at least one password');
    }
}

function showHelp() {
    closeMenu();
    const modal = document.createElement('div');
    modal.className = 'modal show';
    modal.style.cssText = 'display: flex !important;';
    modal.innerHTML = `
        <div class="modal-content" style="max-width: 500px;">
            <h2 style="font-size: 1.5rem; font-weight: 800; margin-bottom: 1rem; color: #0f172a;">üì± How to Use NCHM Pro</h2>
            
            <div style="background: #f8fafc; padding: 1rem; border-radius: 12px; margin-bottom: 1rem; border-left: 4px solid #0ea5e9;">
                <h3 style="font-weight: 700; color: #0f172a; margin-bottom: 0.5rem;">üè† Dashboard</h3>
                <p style="font-size: 0.9rem; color: #475569;">View your daily progress and select areas to check</p>
            </div>
            
            <div style="background: #f8fafc; padding: 1rem; border-radius: 12px; margin-bottom: 1rem; border-left: 4px solid #10b981;">
                <h3 style="font-weight: 700; color: #0f172a; margin-bottom: 0.5rem;">‚úÖ Checking Items</h3>
                <p style="font-size: 0.9rem; color: #475569;">Tap checkboxes to mark items as complete. Add notes and photos as needed.</p>
            </div>
            
            <div style="background: #f8fafc; padding: 1rem; border-radius: 12px; margin-bottom: 1rem; border-left: 4px solid #f59e0b;">
                <h3 style="font-weight: 700; color: #0f172a; margin-bottom: 0.5rem;">üîê Passwords</h3>
                <p style="font-size: 0.9rem; color: #475569;">Default password: <strong>manager123</strong> (for both manager access and unchecking items)</p>
            </div>
            
            <div style="background: #f8fafc; padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem; border-left: 4px solid #ef4444;">
                <h3 style="font-weight: 700; color: #0f172a; margin-bottom: 0.5rem;">üì¶ Archives</h3>
                <p style="font-size: 0.9rem; color: #475569;">Archive completed months and view past records. All data is stored locally on your device.</p>
            </div>
            
            <button class="btn-primary" onclick="this.closest('.modal').remove()" style="width: 100%;">Got it!</button>
        </div>
    `;
    document.body.appendChild(modal);
}

function exportData() {
    closeMenu();
    
    const exportData = {
        checks: checks,
        notes: notes,
        photos: photos,
        waterTemperatures: waterTemperatures,
        monthlyArchives: monthlyArchives,
        photoArchive: window.photoArchive || [],
        exportDate: new Date().toISOString(),
        version: '1.0'
    };
    
    const dataStr = JSON.stringify(exportData, null, 2);
    const blob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `nchm-backup-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    alert('‚úÖ Data exported successfully!');
}

function importData() {
    closeMenu();
    
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            
            reader.onload = function(event) {
                try {
                    const importedData = JSON.parse(event.target.result);
                    
                    if (confirm('‚ö†Ô∏è This will replace all current data. Continue?')) {
                        checks = importedData.checks || {};
                        notes = importedData.notes || {};
                        photos = importedData.photos || {};
                        waterTemperatures = importedData.waterTemperatures || {};
                        monthlyArchives = importedData.monthlyArchives || [];
                        window.photoArchive = importedData.photoArchive || [];
                        
                        saveData();
                        updateStats();
                        renderAreas();
                        
                        alert('‚úÖ Data imported successfully!');
                        location.reload();
                    }
                } catch (error) {
                    alert('‚ùå Error importing data. Please check the file format.');
                    console.error(error);
                }
            };
            
            reader.readAsText(file);
        }
    };
    
    input.click();
}

function showAbout() {
    closeMenu();
    const modal = document.createElement('div');
    modal.className = 'modal show';
    modal.innerHTML = `
        <div class="modal-content" style="text-align: center;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">üè•</div>
            <h2 style="font-size: 1.75rem; font-weight: 800; margin-bottom: 0.5rem; color: #0f172a;">NCHM Pro</h2>
            <p style="color: #64748b; font-size: 1.1rem; font-weight: 600; margin-bottom: 2rem;">Maintenance Tracker</p>
            
            <div style="background: #f8fafc; padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; text-align: left;">
                    <div>
                        <p style="font-size: 0.85rem; color: #64748b; font-weight: 600;">Version</p>
                        <p style="font-weight: 700; color: #0f172a;">1.0.0</p>
                    </div>
                    <div>
                        <p style="font-size: 0.85rem; color: #64748b; font-weight: 600;">Platform</p>
                        <p style="font-weight: 700; color: #0f172a;">Web PWA</p>
                    </div>
                    <div>
                        <p style="font-size: 0.85rem; color: #64748b; font-weight: 600;">Storage</p>
                        <p style="font-weight: 700; color: #0f172a;">Local Device</p>
                    </div>
                    <div>
                        <p style="font-size: 0.85rem; color: #64748b; font-weight: 600;">Offline</p>
                        <p style="font-weight: 700; color: #0f172a;">‚úÖ Available</p>
                    </div>
                </div>
            </div>
            
            <p style="font-size: 0.9rem; color: #64748b; margin-bottom: 1.5rem;">
                Professional maintenance tracking for nursing homes and care facilities
            </p>
            
            <button class="btn-primary" onclick="this.closest('.modal').remove()" style="width: 100%;">Close</button>
        </div>
    `;
    document.body.appendChild(modal);
}

function clearAllData() {
    closeMenu();
    
    // First, ask for manager password
    const modal = document.createElement('div');
    modal.className = 'modal show';
    modal.innerHTML = `
        <div class="modal-content">
            <h2 style="font-size: 1.4rem; font-weight: 700; margin-bottom: 0.5rem; color: #ef4444;">‚ö†Ô∏è Delete All Data</h2>
            <p style="color: #64748b; font-size: 0.95rem; font-weight: 500; margin-bottom: 1rem;">This action requires manager authorization</p>
            
            <div style="background: #fee2e2; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #ef4444;">
                <p style="font-size: 0.9rem; color: #991b1b; font-weight: 600;">
                    ‚ö†Ô∏è WARNING: This will permanently delete ALL data including checks, notes, photos, and archives!
                </p>
            </div>
            
            <label style="font-weight: 600; color: #475569; font-size: 0.95rem;">Enter Manager Password</label>
            <input type="password" id="deletePassword" class="modal-input" placeholder="Manager password required">
            
            <div id="deleteErrorMsg" style="color: #ef4444; font-size: 0.95rem; margin-top: 0.5rem; display: none; font-weight: 600;">
                ‚ùå Incorrect password!
            </div>
            
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                <button class="btn-primary" onclick="confirmDeleteWithPassword()" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                    Delete All Data
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    
    // Focus on password input
    setTimeout(() => document.getElementById('deletePassword').focus(), 100);
}

function confirmDeleteWithPassword() {
    const password = document.getElementById('deletePassword').value;
    const errorMsg = document.getElementById('deleteErrorMsg');
    
    // Check if password matches manager password
    if (password === MANAGER_PASSWORD || password === localStorage.getItem('MANAGER_PASSWORD') || password === 'manager123') {
        // Close password modal
        document.querySelector('.modal').remove();
        
        // Now show final confirmation
        const confirmed = confirm('‚ö†Ô∏è FINAL WARNING!\n\nThis will permanently delete ALL data:\n\n‚Ä¢ All checks\n‚Ä¢ All notes\n‚Ä¢ All photos\n‚Ä¢ All archives\n‚Ä¢ All water temperatures\n\nThis action CANNOT be undone!\n\nAre you absolutely sure?');
        
        if (confirmed) {
            const doubleCheck = prompt('Type "DELETE" in capital letters to confirm:');
            
            if (doubleCheck === 'DELETE') {
                // Clear all data
                checks = {};
                notes = {};
                photos = {};
                waterTemperatures = {};
                monthlyArchives = [];
                window.photoArchive = [];
                
                // Clear localStorage
                localStorage.removeItem('nchmChecks');
                localStorage.removeItem('nchmNotes');
                localStorage.removeItem('nchmPhotos');
                localStorage.removeItem('nchmWaterTemp');
                localStorage.removeItem('nchmArchives');
                
                // Update display
                updateStats();
                renderAreas();
                
                alert('‚úÖ All data has been cleared!');
                location.reload();
            } else {
                alert('‚ùå Deletion cancelled - incorrect confirmation');
            }
        }
    } else {
        // Wrong password
        errorMsg.style.display = 'block';
        document.getElementById('deletePassword').value = '';
        document.getElementById('deletePassword').focus();
    }
}
        function updateManagerDashboard() {
            let totalChecks = 0;
            areas.forEach(area => {
                const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                totalChecks += area.items.length * currentCheckItems.length;
            });

            const completedChecks = Object.keys(checks).filter(key => checks[key]).length;
            const percentage = totalChecks > 0 ? Math.round((completedChecks / totalChecks) * 100) : 0;

            let completedItems = 0;
            areas.forEach(area => {
                const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                area.items.forEach(item => {
                    const itemKey = area.id + '-' + item;
                    const itemChecks = currentCheckItems.filter(ci => checks[itemKey + '-' + ci]);
                    if (itemChecks.length === currentCheckItems.length) {
                        completedItems++;
                    }
                });
            });

            const totalItems = areas.reduce((sum, area) => sum + area.items.length, 0);

            document.getElementById('managerTotalPercent').textContent = percentage + '%';
            document.getElementById('managerCompleted').textContent = completedItems;
            document.getElementById('managerTotal').textContent = totalItems;

            const perfFill = document.getElementById('performanceFill');
            perfFill.style.width = percentage + '%';
            
            if (percentage >= 80) {
                perfFill.className = 'performance-fill excellent';
            } else if (percentage >= 60) {
                perfFill.className = 'performance-fill good';
            } else if (percentage >= 40) {
                perfFill.className = 'performance-fill warning';
            } else {
                perfFill.className = 'performance-fill poor';
            }

            updateCalendar(percentage);
            updateAreasProgress();
            updateAlerts(percentage);
            updateMetrics(percentage);
        }

        function updateCalendar(todayPercentage) {
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';

            const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const currentDay = 6;
            const daysInMonth = 31;
            const daysRemaining = daysInMonth - currentDay;

            document.getElementById('daysRemaining').textContent = daysRemaining;

            daysOfWeek.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day header';
                header.textContent = day;
                calendarGrid.appendChild(header);
            });

            for (let i = 1; i <= daysInMonth; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                
                if (i === currentDay) {
                    day.classList.add('today');
                    if (todayPercentage >= 80) {
                        day.classList.add('completed');
                    } else if (todayPercentage >= 50) {
                        day.classList.add('partial');
                    } else if (todayPercentage > 0) {
                        day.classList.add('partial');
                    }
                } else if (i < currentDay) {
                    const randomPerf = 60 + Math.random() * 40;
                    if (randomPerf >= 80) {
                        day.classList.add('completed');
                    } else if (randomPerf >= 50) {
                        day.classList.add('partial');
                    } else {
                        day.classList.add('missed');
                    }
                }
                
                day.textContent = i;
                calendarGrid.appendChild(day);
            }
        }

        function updateAreasProgress() {
            const container = document.getElementById('areasProgressContainer');
            container.innerHTML = '';

            areas.forEach(area => {
                const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                const areaChecks = Object.keys(checks).filter(k => k.startsWith(area.id + '-')).filter(k => checks[k]);
                const areaTotal = area.items.length * currentCheckItems.length;
                const areaPercentage = areaTotal > 0 ? Math.round((areaChecks.length / areaTotal) * 100) : 0;

                const item = document.createElement('div');
                item.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 2px solid #f1f5f9;';
                item.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span style="font-size: 1.75rem;">${area.icon}</span>
                        <div>
                            <div style="font-weight: 600; color: #0f172a;">${area.name}</div>
                            <div style="font-size: 0.85rem; color: #64748b; font-weight: 500;">${area.items.length} items</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.3rem; font-weight: 800; color: ${areaPercentage >= 80 ? '#10b981' : areaPercentage >= 50 ? '#f59e0b' : '#ef4444'};">
                            ${areaPercentage}%
                        </div>
                        <span style="display: inline-block; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 700; background: ${areaPercentage >= 80 ? 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)' : areaPercentage >= 50 ? 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)' : 'linear-gradient(135deg, #fee2e2 0%, #fecaca 100%)'}; color: ${areaPercentage >= 80 ? '#059669' : areaPercentage >= 50 ? '#d97706' : '#dc2626'};">
                            ${areaPercentage >= 80 ? 'Excellent' : areaPercentage >= 50 ? 'Fair' : 'Needs Work'}
                        </span>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function updateAlerts(percentage) {
            const alertSection = document.getElementById('alertSection');
            alertSection.innerHTML = '';

            const currentDay = 6;
            const daysInMonth = 31;
            const daysRemaining = daysInMonth - currentDay;
            const daysElapsed = currentDay;
            const expectedProgress = (daysElapsed / daysInMonth) * 100;

            if (daysRemaining <= 7 && percentage < 50) {
                const alert = document.createElement('div');
                alert.className = 'alert-box alert-danger';
                alert.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="font-size: 1.75rem;">üö®</div>
                        <div>
                            <div style="font-weight: 700; margin-bottom: 0.25rem;">Critical: End of Month Alert</div>
                            <div style="font-size: 0.95rem; font-weight: 500;">Only ${daysRemaining} days remaining with ${percentage}% completion. Immediate discussion required!</div>
                        </div>
                    </div>
                `;
                alertSection.appendChild(alert);
            } else if (daysRemaining <= 7 && percentage < 80) {
                const alert = document.createElement('div');
                alert.className = 'alert-box alert-warning';
                alert.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="font-size: 1.75rem;">‚ö†Ô∏è</div>
                        <div>
                            <div style="font-weight: 700; margin-bottom: 0.25rem;">Warning: Below Target</div>
                            <div style="font-size: 0.95rem; font-weight: 500;">Only ${daysRemaining} days left. Current: ${percentage}%. Consider accelerating schedule.</div>
                        </div>
                    </div>
                `;
                alertSection.appendChild(alert);
            }

            if (percentage < expectedProgress - 10) {
                const alert = document.createElement('div');
                alert.className = 'alert-box alert-warning';
                alert.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="font-size: 1.75rem;">üìâ</div>
                        <div>
                            <div style="font-weight: 700; margin-bottom: 0.25rem;">Behind Schedule</div>
                            <div style="font-size: 0.95rem; font-weight: 500;">Expected ${Math.round(expectedProgress)}% by day ${currentDay}, but only ${percentage}% completed.</div>
                        </div>
                    </div>
                `;
                alertSection.appendChild(alert);
            }

            if (percentage >= 90) {
                const alert = document.createElement('div');
                alert.className = 'alert-box alert-success';
                alert.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="font-size: 1.75rem;">‚úÖ</div>
                        <div>
                            <div style="font-weight: 700; margin-bottom: 0.25rem;">Excellent Performance!</div>
                            <div style="font-size: 0.95rem; font-weight: 500;">Team performing exceptionally with ${percentage}% completion.</div>
                        </div>
                    </div>
                `;
                alertSection.appendChild(alert);
            }
        }

        function updateMetrics(percentage) {
            const avgDaily = Math.min(percentage, 100);
            document.getElementById('avgDailyCompletion').textContent = avgDaily + '%';

            const currentDay = 6;
            const expectedProgress = (currentDay / 31) * 100;
            const onTrack = percentage >= expectedProgress - 5;
            
            document.getElementById('onTrack').textContent = onTrack ? 'Yes' : 'No';
            document.getElementById('onTrack').style.color = onTrack ? '#0284c7' : '#ef4444';
        }

        function archiveCurrentMonth() {
            const currentDate = new Date();
            const monthName = 'October 2025';
            
            const archive = {
                id: Date.now(),
                month: monthName,
                date: currentDate.toISOString(),
                checks: JSON.parse(JSON.stringify(checks)),
                notes: JSON.parse(JSON.stringify(notes)),
                photos: JSON.parse(JSON.stringify(photos)),
                waterTemperatures: JSON.parse(JSON.stringify(waterTemperatures)),
                areas: JSON.parse(JSON.stringify(areas))
            };
            
            let totalChecks = 0;
            areas.forEach(area => {
                const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                totalChecks += area.items.length * currentCheckItems.length;
            });
            
            const completedChecks = Object.keys(checks).filter(key => checks[key]).length;
            archive.completionRate = totalChecks > 0 ? Math.round((completedChecks / totalChecks) * 100) : 0;
            
            monthlyArchives.unshift(archive);
            saveData();
            
            if (confirm('Archive created! Reset all checks for new month?')) {
                checks = {};
                notes = {};
                photos = {};
                waterTemperatures = {};
                saveData();
                updateStats();
                renderAreas();
            }
            
            alert('‚úÖ Month archived successfully!');
            loadArchives();
        }

        function loadArchives() {
            const container = document.getElementById('archivesContainer');
            
            if (monthlyArchives.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #64748b;">
                        <div style="font-size: 3.5rem; margin-bottom: 1rem;">üì¶</div>
                        <p style="font-weight: 600; font-size: 1.1rem;">No archived months yet</p>
                        <p style="font-size: 0.95rem; margin-top: 0.5rem; font-weight: 500;">Archive the current month to save records</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            monthlyArchives.forEach((archive, index) => {
                const card = document.createElement('div');
                card.className = 'archive-card';
                card.onclick = () => viewArchive(index);
                
                const date = new Date(archive.date);
                const formattedDate = date.toLocaleDateString('en-GB', { 
                    day: 'numeric', 
                    month: 'long', 
                    year: 'numeric' 
                });
                
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 1.25rem; font-weight: 700; color: #0f172a; margin-bottom: 0.25rem;">
                                üìÖ ${archive.month}
                            </div>
                            <div style="font-size: 0.95rem; color: #64748b; font-weight: 500;">
                                Archived: ${formattedDate}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 2rem; font-weight: 800; color: ${archive.completionRate >= 80 ? '#10b981' : archive.completionRate >= 50 ? '#f59e0b' : '#ef4444'};">
                                ${archive.completionRate}%
                            </div>
                            <div style="font-size: 0.85rem; color: #64748b; font-weight: 600;">Complete</div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 2px solid #f1f5f9; display: flex; gap: 0.75rem;">
                        <button onclick="event.stopPropagation(); viewArchive(${index})" 
                                style="flex: 1; padding: 0.75rem; background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 700; transition: all 0.3s ease;">
                            üëÅÔ∏è View
                        </button>
                        <button onclick="event.stopPropagation(); printArchive(${index})" 
                                style="flex: 1; padding: 0.75rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 700; transition: all 0.3s ease;">
                            üñ®Ô∏è Print
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function viewArchive(index) {
            const archive = monthlyArchives[index];
            const printContent = document.getElementById('printContent');
            printContent.innerHTML = generatePrintHTML(archive);
            showView('print');
        }

        function printArchive(index) {
            const archive = monthlyArchives[index];
            const printContent = document.getElementById('printContent');
            printContent.innerHTML = generatePrintHTML(archive);
            showView('print');
            
            setTimeout(() => {
                window.print();
            }, 500);
        }

        function generatePrintHTML(archive) {
            let html = `
                <div style="margin-bottom: 2rem;">
                    <h2 style="font-size: 1.75rem; font-weight: 800; color: #0f172a; margin-bottom: 0.5rem;">${archive.month}</h2>
                    <p style="color: #64748b; font-weight: 600;">Completion Rate: <strong style="color: ${archive.completionRate >= 80 ? '#10b981' : archive.completionRate >= 50 ? '#f59e0b' : '#ef4444'};">${archive.completionRate}%</strong></p>
                </div>
            `;

            archive.areas.forEach(area => {
                html += `<div style="margin-bottom: 2rem; page-break-inside: avoid;">
                    <h3 style="font-size: 1.3rem; font-weight: 700; color: #0f172a; margin-bottom: 1rem;">${area.icon} ${area.name}</h3>
                `;

                area.items.forEach(item => {
                    const itemKey = area.id + '-' + item;
                    const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                    
                    html += `<div style="margin-bottom: 1.5rem; padding: 1.25rem; background: #f8fafc; border-radius: 12px; border: 2px solid #e2e8f0;">
                        <h4 style="font-weight: 700; margin-bottom: 0.75rem; color: #0f172a;">${item}</h4>
                        <ul style="list-style: none; padding-left: 0;">
                    `;

                    currentCheckItems.forEach(checkItem => {
                        const checkKey = itemKey + '-' + checkItem;
                        const isChecked = archive.checks[checkKey];
                        html += `<li style="margin-bottom: 0.5rem; font-weight: 500;">${isChecked ? '‚úÖ' : '‚ùå'} ${checkItem}</li>`;
                    });

                    html += `</ul>`;

                    if (archive.notes[itemKey]) {
                        html += `<div style="margin-top: 0.75rem; padding: 1rem; background: white; border-radius: 8px; border: 2px solid #e2e8f0;">
                            <strong style="font-weight: 700;">Notes:</strong> ${archive.notes[itemKey]}
                        </div>`;
                    }

                    if (archive.photos[itemKey]) {
                        html += `<div style="margin-top: 0.5rem; color: #0ea5e9; font-weight: 600;">
                            üì∑ ${archive.photos[itemKey]} photo(s) attached
                        </div>`;
                    }

                    html += `</div>`;
                });

                html += `</div>`;
            });

            return html;
        }

        function showManagerPasswordModal() {
            const modal = document.getElementById('managerPasswordModal');
            const input = document.getElementById('managerPasswordInput');
            const errorMsg = document.getElementById('managerErrorMsg');
            
            if (modal && input && errorMsg) {
                modal.classList.add('show');
                input.value = '';
                errorMsg.style.display = 'none';
                setTimeout(() => input.focus(), 100);
            }
        }

        function closeManagerPasswordModal() {
            const modal = document.getElementById('managerPasswordModal');
            const input = document.getElementById('managerPasswordInput');
            const errorMsg = document.getElementById('managerErrorMsg');
            
            if (modal) modal.classList.remove('show');
            if (input) input.value = '';
            if (errorMsg) errorMsg.style.display = 'none';
        }

        function verifyManagerPassword() {
            const inputPassword = document.getElementById('managerPasswordInput').value;
            
            if (inputPassword === MANAGER_PASSWORD) {
                closeManagerPasswordModal();
                showView('manager');
            } else {
                document.getElementById('managerErrorMsg').style.display = 'block';
                document.getElementById('managerPasswordInput').value = '';
                document.getElementById('managerPasswordInput').focus();
            }
        }

        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (document.getElementById('passwordModal').classList.contains('show')) {
                    verifyPassword();
                }
                if (document.getElementById('managerPasswordModal').classList.contains('show')) {
                    verifyManagerPassword();
                }
            }
        });

        init();
    </script>
</body>
</html>