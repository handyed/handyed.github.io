<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCHM- Maintenance App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f7fafc;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 768px;
            margin: 0 auto;
            background: #f7fafc;
            min-height: 100vh;
            padding-bottom: 80px;
            width: 100%;
        }

        @media (max-width: 640px) {
            .app-container {
                padding-bottom: 70px;
            }
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        @media (max-width: 640px) {
            .header {
                padding: 1rem;
            }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.3rem;
            margin-bottom: 0.2rem;
        }

        @media (max-width: 640px) {
            .header h1 {
                font-size: 1.1rem;
            }
        }

        .header p {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        @media (max-width: 640px) {
            .header p {
                font-size: 0.75rem;
            }
        }

        .menu-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            color: white;
            font-size: 1.5rem;
        }

        .content {
            padding: 1.5rem;
        }

        @media (max-width: 640px) {
            .content {
                padding: 1rem;
            }
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        @media (max-width: 640px) {
            .page-title {
                font-size: 1.25rem;
            }
        }

        .progress-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 640px) {
            .progress-card {
                padding: 1rem;
            }
        }

        .progress-number {
            font-size: 2rem;
            font-weight: bold;
        }

        @media (max-width: 640px) {
            .progress-number {
                font-size: 1.5rem;
            }
        }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            height: 12px;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0 0.5rem 0;
        }

        .progress-fill {
            background: white;
            height: 100%;
            transition: width 0.3s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 640px) {
            .stats-grid {
                gap: 0.75rem;
            }
        }

        .stat-card {
            padding: 1.5rem;
            border-radius: 12px;
            border: 2px solid;
        }

        @media (max-width: 640px) {
            .stat-card {
                padding: 1rem;
            }
        }

        .stat-card.completed {
            background: #f0fdf4;
            border-color: #bbf7d0;
        }

        .stat-card.remaining {
            background: #fff7ed;
            border-color: #fed7aa;
        }

        .area-card {
            background: white;
            padding: 1.25rem;
            border-radius: 12px;
            margin-bottom: 0.75rem;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        @media (max-width: 640px) {
            .area-card {
                padding: 1rem;
            }
        }

        .area-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .area-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .check-item-card {
            background: white;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .check-item-header {
            padding: 1rem;
            background: #f7fafc;
        }

        @media (max-width: 640px) {
            .check-item-header {
                padding: 0.75rem;
            }
        }

        .check-item-header.complete {
            background: #f0fdf4;
            border-left: 4px solid #16a34a;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            margin: 0.5rem 0;
        }

        .checklist-item:hover {
            background: #f7fafc;
        }

        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #cbd5e0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .checkbox.checked {
            background: #16a34a;
            border-color: #16a34a;
            color: white;
        }

        .notes-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
            margin-top: 0.5rem;
        }

        .btn {
            padding: 0.75rem 1.25rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin-top: 1rem;
        }

        @media (max-width: 640px) {
            .btn {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }
        }

        .btn-photo {
            background: #eff6ff;
            color: #2563eb;
            margin-right: 0.5rem;
        }

        .btn-save {
            background: #667eea;
            color: white;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e2e8f0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            max-width: 768px;
            margin: 0 auto;
            display: flex;
            z-index: 100;
        }

        .nav-btn {
            flex: 1;
            border: none;
            background: none;
            padding: 0.75rem;
            cursor: pointer;
            color: #9ca3af;
            font-size: 0.7rem;
        }

        @media (max-width: 640px) {
            .nav-btn {
                padding: 0.5rem 0.25rem;
                font-size: 0.65rem;
            }
            .nav-btn > div:first-child {
                font-size: 1.25rem !important;
            }
        }

        .nav-btn.active {
            color: #667eea;
        }

        .hidden {
            display: none;
        }

        .back-btn {
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            margin-bottom: 1rem;
            font-size: 1rem;
        }

        .manager-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        @media (max-width: 640px) {
            .manager-card {
                padding: 1rem;
            }
        }

        .alert-box {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid;
        }

        @media (max-width: 640px) {
            .alert-box {
                padding: 0.75rem;
            }
        }

        .alert-warning {
            background: #fef3c7;
            border-color: #f59e0b;
        }

        .alert-danger {
            background: #fee2e2;
            border-color: #ef4444;
            animation: pulse 2s infinite;
        }

        .alert-success {
            background: #d1fae5;
            border-color: #10b981;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        @media (max-width: 640px) {
            .calendar-grid {
                gap: 0.25rem;
            }
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        @media (max-width: 640px) {
            .calendar-day {
                font-size: 0.75rem;
            }
        }

        .calendar-day.header {
            background: #f7fafc;
            color: #718096;
            font-weight: 600;
        }

        .calendar-day.completed {
            background: #d1fae5;
            color: #059669;
        }

        .calendar-day.partial {
            background: #fed7aa;
            color: #c2410c;
        }

        .calendar-day.missed {
            background: #fee2e2;
            color: #dc2626;
        }

        .calendar-day.today {
            border: 2px solid #667eea;
        }

        .performance-meter {
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .performance-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .performance-fill.excellent {
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .performance-fill.good {
            background: linear-gradient(90deg, #3b82f6, #2563eb);
        }

        .performance-fill.warning {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .performance-fill.poor {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .stat-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        @media (max-width: 640px) {
            .stat-badge {
                font-size: 0.75rem;
                padding: 0.2rem 0.5rem;
            }
        }

        .area-progress-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .area-progress-item:last-child {
            border-bottom: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        @media (max-width: 640px) {
            .modal-content {
                padding: 1.5rem;
                width: 95%;
            }
        }

        .modal-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            font-size: 1rem;
            margin: 1rem 0;
        }

        .modal-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-primary {
            flex: 1;
            padding: 0.75rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-secondary {
            flex: 1;
            padding: 0.75rem;
            background: #e5e7eb;
            color: #4b5563;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .archive-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.3s;
        }

        @media (max-width: 640px) {
            .archive-card {
                padding: 1rem;
            }
        }

        .archive-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        @media print {
            .no-print {
                display: none !important;
            }
            .app-container {
                max-width: 100%;
                padding-bottom: 0;
            }
            .print-only {
                display: block !important;
            }
            body {
                background: white;
            }
            .content {
                padding: 1rem;
            }
        }

        .print-only {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Display Maintenance Person Name -->
<div id="maintenanceInfo" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; text-align: center; margin-bottom: 20px; border-radius: 10px;">
    <h3 style="margin: 0; font-size: 18px;">Maintenance Technician: <span id="technicianName">Loading...</span></h3>
    <p style="margin: 5px 0 0 0; font-size: 12px; opacity: 0.9;" id="loginTime"></p>
</div>
    <div class="app-container">
        <div class="header no-print">
            <div class="header-content">
                <div>
                    <h1>NCHM</h1>
                    <p>Maintenance Checks</p>
                </div>
                <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
            </div>
        </div>

        <div id="dashboardView" class="content">
            <h1 class="page-title">Today's Checks</h1>
            <p style="color: #718096; margin-bottom: 1.5rem;">Monday, October 06, 2025</p>

            <div class="progress-card">
                <p style="opacity: 0.9; font-size: 0.9rem;">Progress Today</p>
                <p class="progress-number"><span id="completedCount">0</span>/<span id="totalCount">25</span></p>
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                </div>
                <p style="font-size: 0.85rem; opacity: 0.9;"><span id="progressPercent">0</span>% Complete</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card completed">
                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚úì</div>
                    <p style="font-size: 1.8rem; font-weight: bold; color: #15803d;" id="completedStat">0</p>
                    <p style="font-size: 0.9rem; color: #16a34a;">Completed</p>
                </div>
                <div class="stat-card remaining">
                    <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚è∞</div>
                    <p style="font-size: 1.8rem; font-weight: bold; color: #c2410c;" id="remainingStat">25</p>
                    <p style="font-size: 0.9rem; color: #ea580c;">Remaining</p>
                </div>
            </div>

            <h2 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem;">Areas to Check</h2>
            <div id="areasContainer"></div>
        </div>

        <div id="checklistView" class="content hidden">
            <button class="back-btn" onclick="showDashboard()">‚Üê Back to Dashboard</button>
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                <span id="areaIconLarge" style="font-size: 2.5rem;"></span>
                <h1 class="page-title" id="areaTitle" style="margin: 0;"></h1>
            </div>
            <p style="color: #718096; margin-bottom: 1.5rem;" id="areaItemCount"></p>
            <div id="checkItemsContainer"></div>
        </div>

        <div id="reportsView" class="content hidden">
            <h1 class="page-title">Reports</h1>
            <div style="background: white; border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0;">
                <h2 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem;">Today's Summary</h2>
                <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #e2e8f0;">
                    <span>Total Checks</span>
                    <span style="font-weight: 600;" id="reportTotal">25</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #e2e8f0;">
                    <span>Completed</span>
                    <span style="font-weight: 600; color: #16a34a;" id="reportCompleted">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 0.75rem 0;">
                    <span>Completion Rate</span>
                    <span style="font-weight: 600; color: #667eea;" id="reportPercent">0%</span>
                </div>
            </div>
        </div>

        <div id="managerView" class="content hidden">
            <h1 class="page-title">Manager Dashboard</h1>
            <p style="color: #718096; margin-bottom: 1.5rem;">Maintenance Performance Overview</p>

            <div id="alertSection"></div>

            <div class="manager-card">
                <h2 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem;">Overall Performance</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <div>
                        <div style="font-size: 2.5rem; font-weight: bold; color: #667eea;" id="managerTotalPercent">0%</div>
                        <div style="color: #718096; font-size: 0.9rem;">Completion Rate</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #16a34a;" id="managerCompleted">0</div>
                        <div style="color: #718096; font-size: 0.9rem;">of <span id="managerTotal">25</span> items</div>
                    </div>
                </div>
                <div class="performance-meter">
                    <div id="performanceFill" class="performance-fill excellent" style="width: 0%"></div>
                </div>
            </div>

            <div class="manager-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2 style="font-size: 1.1rem; font-weight: 600;">October 2025</h2>
                    <div style="font-size: 0.85rem; color: #718096;">
                        Days Remaining: <span id="daysRemaining" style="font-weight: 600; color: #667eea;">25</span>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
                <div style="display: flex; gap: 1rem; margin-top: 1rem; font-size: 0.8rem; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="width: 16px; height: 16px; background: #d1fae5; border-radius: 4px;"></div>
                        <span>Complete</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="width: 16px; height: 16px; background: #fed7aa; border-radius: 4px;"></div>
                        <span>Partial</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <div style="width: 16px; height: 16px; background: #fee2e2; border-radius: 4px;"></div>
                        <span>Missed</span>
                    </div>
                </div>
            </div>

            <div class="manager-card">
                <h2 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem;">Progress by Area</h2>
                <div id="areasProgressContainer"></div>
            </div>

            <div class="manager-card">
                <h2 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem;">Performance Metrics</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div style="text-align: center; padding: 1rem; background: #f0fdf4; border-radius: 8px;">
                        <div style="font-size: 1.8rem; font-weight: bold; color: #16a34a;" id="avgDailyCompletion">0%</div>
                        <div style="font-size: 0.85rem; color: #15803d; margin-top: 0.25rem;">Avg Daily Rate</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: #eff6ff; border-radius: 8px;">
                        <div style="font-size: 1.8rem; font-weight: bold; color: #2563eb;" id="onTrack">Yes</div>
                        <div style="font-size: 0.85rem; color: #1e40af; margin-top: 0.25rem;">On Track</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="archiveView" class="content hidden">
            <h1 class="page-title">Monthly Archives</h1>
            <p style="color: #718096; margin-bottom: 1.5rem;">View and print past maintenance records</p>
            
            <button class="btn btn-primary" onclick="archiveCurrentMonth()" style="margin-bottom: 1.5rem; width: 100%;">
                üì¶ Archive Current Month
            </button>

            <div id="archivesContainer"></div>
        </div>

        <div id="printView" class="content hidden">
            <div class="no-print">
                <button class="back-btn" onclick="showView('archive')">‚Üê Back to Archives</button>
            </div>
            
            <div style="background: white; padding: 2rem; border-radius: 12px;">
                <div class="print-only" style="text-align: center; margin-bottom: 2rem;">
                    <h1 style="color: #667eea;">NCHM</h1>
                    <p>Maintenance Records</p>
                </div>

                <div id="printContent"></div>

                <div class="no-print" style="margin-top: 2rem;">
                    <button class="btn btn-primary" onclick="window.print()" style="width: 100%;">
                        üñ®Ô∏è Print Report
                    </button>
                </div>
            </div>
        </div>

        <div id="passwordModal" class="modal">
            <div class="modal-content">
                <h2 style="font-size: 1.3rem; font-weight: 600; margin-bottom: 0.5rem;">Password Required</h2>
                <p style="color: #718096; font-size: 0.9rem;">Enter password to uncheck this item</p>
                <input type="password" id="passwordInput" class="modal-input" placeholder="Enter password">
                <div class="modal-buttons">
                    <button class="btn-secondary" onclick="closePasswordModal()">Cancel</button>
                    <button class="btn-primary" onclick="verifyPassword()">Confirm</button>
                </div>
            </div>
        </div>

        <div class="bottom-nav no-print">
            <button onclick="window.location.href='login.html'">
                     üè† Home
            </button>
            </button>
            <button class="nav-btn" onclick="showView('checklist')">
                <div style="font-size: 1.5rem;">üìù</div>
                <div>Checks</div>
            </button>
            <button class="nav-btn" onclick="showView('reports')">
                <div style="font-size: 1.5rem;">üìä</div>
                <div>Reports</div>
            </button>
            <button class="nav-btn" onclick="showView('manager')">
                <div style="font-size: 1.5rem;">üëî</div>
                <div>Manager</div>
            </button>
            <button class="nav-btn" onclick="showView('archive')">
                <div style="font-size: 1.5rem;">üì¶</div>
                <div>Archive</div>
            </button>
        </div>
    </div>

    <script>
        const areas = [
            { id: 'rooms', name: 'Resident Rooms', icon: 'üõèÔ∏è', items: ['Room 101', 'Room 102', 'Room 103', 'Room 104', 'Room 105'] },
            { id: 'corridors', name: 'Corridors', icon: 'üö™', items: ['Ground Floor Corridor', 'First Floor Corridor', 'Second Floor Corridor'] },
            { id: 'equipment', name: 'Air Mattresses', icon: 'üõå', items: ['Room 101 Mattress', 'Room 102 Mattress', 'Room 103 Mattress', 'Room 104 Mattress'] },
            { id: 'safety', name: 'Safety Equipment', icon: 'üî•', items: ['Fire Extinguishers', 'Emergency Lighting', 'Smoke Detectors', 'Exit Signs'] },
            { id: 'bathrooms', name: 'Bathrooms', icon: 'üöø', items: ['Ground Floor Bathroom', 'First Floor Bathroom', 'Second Floor Bathroom'] },
            { id: 'kitchen', name: 'Kitchen', icon: 'üç≥', items: ['Kitchen Equipment', 'Refrigeration', 'Food Storage Areas'] }
        ];

        const checkItemsByArea = {
            'rooms': [
                'General condition good',
                'Wardrobe checked',
                'Bed checked',
                'Air mattress/Foam mattress',
                'Radiator working',
                'Sockets functioning',
                'Light working',
                'Window secure',
                'Door functioning',
                'Curtains checked',
                'Smoke detector',
                'Call bell working'
            ],
            'default': ['General condition good', 'No visible damage', 'Clean and tidy', 'Equipment functioning', 'Safety standards met', 'No hazards present']
        };

        let checks = {};
        let notes = {};
        let photos = {};
        let waterTemperatures = {};
        let selectedArea = null;
        let monthlyArchives = [];
        let pendingUncheck = null;
        const UNCHECK_PASSWORD = 'manager123';

        function init() {
            renderAreas();
            updateStats();
        }

        function showView(view) {
            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('checklistView').classList.add('hidden');
            document.getElementById('reportsView').classList.add('hidden');
            document.getElementById('managerView').classList.add('hidden');
            document.getElementById('archiveView').classList.add('hidden');
            document.getElementById('printView').classList.add('hidden');

            if (view === 'dashboard') {
                document.getElementById('dashboardView').classList.remove('hidden');
            } else if (view === 'checklist') {
                if (selectedArea) {
                    document.getElementById('checklistView').classList.remove('hidden');
                } else {
                    document.getElementById('dashboardView').classList.remove('hidden');
                }
            } else if (view === 'reports') {
                document.getElementById('reportsView').classList.remove('hidden');
            } else if (view === 'manager') {
                document.getElementById('managerView').classList.remove('hidden');
                updateManagerDashboard();
            } else if (view === 'archive') {
                document.getElementById('archiveView').classList.remove('hidden');
                loadArchives();
            } else if (view === 'print') {
                document.getElementById('printView').classList.remove('hidden');
            }

            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const btns = document.querySelectorAll('.nav-btn');
            const btnIndex = view === 'dashboard' ? 0 : view === 'checklist' ? 1 : view === 'reports' ? 2 : view === 'manager' ? 3 : 4;
            if (btns[btnIndex]) btns[btnIndex].classList.add('active');

            updateStats();
        }

        function renderAreas() {
            const container = document.getElementById('areasContainer');
            container.innerHTML = '';

            areas.forEach(area => {
                const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                const areaChecks = Object.keys(checks).filter(k => k.startsWith(area.id + '-')).filter(k => checks[k]);
                const areaTotal = area.items.length * currentCheckItems.length;
                const areaPercentage = areaTotal > 0 ? Math.round((areaChecks.length / areaTotal) * 100) : 0;

                const card = document.createElement('div');
                card.className = 'area-card';
                card.onclick = () => selectArea(area);
                card.innerHTML = `
                    <div class="area-content">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="font-size: 2rem;">${area.icon}</div>
                            <div>
                                <div style="font-weight: 600; color: #2d3748;">${area.name}</div>
                                <div style="font-size: 0.85rem; color: #718096;">${area.items.length} items</div>
                            </div>
                        </div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: ${areaPercentage === 100 ? '#16a34a' : '#cbd5e0'};">${areaPercentage}%</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function selectArea(area) {
            selectedArea = area;
            document.getElementById('areaIconLarge').textContent = area.icon;
            document.getElementById('areaTitle').textContent = area.name;
            document.getElementById('areaItemCount').textContent = area.items.length + ' items to check';
            renderCheckItems();
            showView('checklist');
        }

        function renderCheckItems() {
            const container = document.getElementById('checkItemsContainer');
            container.innerHTML = '';
            const currentCheckItems = checkItemsByArea[selectedArea.id] || checkItemsByArea['default'];

            selectedArea.items.forEach((item) => {
                const itemKey = selectedArea.id + '-' + item;
                const itemChecks = currentCheckItems.filter(ci => checks[itemKey + '-' + ci]);
                const isComplete = itemChecks.length === currentCheckItems.length;

                const card = document.createElement('div');
                card.className = 'check-item-card';
                
                let checklistHTML = currentCheckItems.map((checkItem) => {
                    const checkKey = itemKey + '-' + checkItem;
                    const isChecked = checks[checkKey];
                    return `
                        <div class="checklist-item" onclick="toggleCheck('${selectedArea.id}', '${item}', '${checkItem}')">
                            <div class="checkbox ${isChecked ? 'checked' : ''}">
                                ${isChecked ? '‚úì' : ''}
                            </div>
                            <div style="color: ${isChecked ? '#2d3748' : '#4a5568'};">${checkItem}</div>
                        </div>
                    `;
                }).join('');

                let waterTempHTML = '';
                if (selectedArea.id === 'rooms') {
                    const tempKey = itemKey + '-waterTemp';
                    const currentTemp = waterTemperatures[tempKey] || 40;
                    waterTempHTML = `
                        <div style="margin-top: 1rem; padding: 1rem; background: #f7fafc; border-radius: 8px;">
                            <label style="font-size: 0.9rem; font-weight: 500; color: #4a5568; display: block; margin-bottom: 0.5rem;">
                                üå°Ô∏è Water Temperature (¬∞C)
                            </label>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <input type="range" min="30" max="50" value="${currentTemp}" 
                                       style="flex: 1;" 
                                       oninput="updateWaterTemp('${itemKey}', this.value)">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #667eea; min-width: 60px;">
                                    <span id="temp-${itemKey}">${currentTemp}</span>¬∞C
                                </div>
                            </div>
                        </div>
                    `;
                }

                card.innerHTML = `
                    <div class="check-item-header ${isComplete ? 'complete' : ''}">
                        <div style="font-weight: 600; color: #2d3748;">${item}</div>
                        ${isComplete ? '<div style="color: #16a34a; font-size: 0.85rem; margin-top: 0.3rem;">‚úì Complete</div>' : ''}
                    </div>
                    <div style="padding: 1rem;">
                        ${checklistHTML}
                        ${waterTempHTML}
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e2e8f0;">
                            <label style="font-size: 0.9rem; font-weight: 500; color: #4a5568;">Notes (optional)</label>
                            <textarea class="notes-textarea" placeholder="Add any notes or issues found..." onchange="saveNote('${selectedArea.id}', '${item}', this.value)">${notes[itemKey] || ''}</textarea>
                        </div>
                        <button class="btn btn-photo" onclick="addPhoto('${selectedArea.id}', '${item}')">
                            üì∑ Add Photo ${photos[itemKey] ? '(' + photos[itemKey] + ')' : ''}
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function toggleCheck(areaId, item, checkItem) {
            const key = areaId + '-' + item + '-' + checkItem;
            
            if (checks[key]) {
                pendingUncheck = key;
                document.getElementById('passwordModal').classList.add('show');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
                return;
            }
            
            checks[key] = true;
            updateStats();
            renderCheckItems();
            renderAreas();
            
            if (!document.getElementById('managerView').classList.contains('hidden')) {
                updateManagerDashboard();
            }
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('show');
            pendingUncheck = null;
            document.getElementById('passwordInput').value = '';
        }

        function verifyPassword() {
            const inputPassword = document.getElementById('passwordInput').value;
            
            if (inputPassword === UNCHECK_PASSWORD) {
                if (pendingUncheck) {
                    checks[pendingUncheck] = false;
                    updateStats();
                    renderCheckItems();
                    renderAreas();
                    
                    if (!document.getElementById('managerView').classList.contains('hidden')) {
                        updateManagerDashboard();
                    }
                }
                closePasswordModal();
            } else {
                alert('‚ùå Incorrect password! Cannot uncheck item.');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        function saveNote(areaId, item, value) {
            notes[areaId + '-' + item] = value;
        }

        function addPhoto(areaId, item) {
            const key = areaId + '-' + item;
            photos[key] = (photos[key] || 0) + 1;
            renderCheckItems();
        }

        function updateWaterTemp(itemKey, value) {
            waterTemperatures[itemKey + '-waterTemp'] = value;
            document.getElementById('temp-' + itemKey).textContent = value;
        }

        function updateStats() {
            let totalChecks = 0;
            areas.forEach(area => {
                const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                totalChecks += area.items.length * currentCheckItems.length;
            });

            const completedChecks = Object.keys(checks).filter(key => checks[key]).length;
            const percentage = totalChecks > 0 ? Math.round((completedChecks / totalChecks) * 100) : 0;

            let completedItems = 0;
            areas.forEach(area => {
                const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                area.items.forEach(item => {
                    const itemKey = area.id + '-' + item;
                    const itemChecks = currentCheckItems.filter(ci => checks[itemKey + '-' + ci]);
                    if (itemChecks.length === currentCheckItems.length) {
                        completedItems++;
                    }
                });
            });

            const totalItems = areas.reduce((sum, area) => sum + area.items.length, 0);

            document.getElementById('completedCount').textContent = completedItems;
            document.getElementById('totalCount').textContent = totalItems;
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressPercent').textContent = percentage;
            document.getElementById('completedStat').textContent = completedItems;
            document.getElementById('remainingStat').textContent = totalItems - completedItems;
            document.getElementById('reportTotal').textContent = totalItems;
            document.getElementById('reportCompleted').textContent = completedItems;
            document.getElementById('reportPercent').textContent = percentage + '%';
            
            if (!document.getElementById('managerView').classList.contains('hidden')) {
                updateManagerDashboard();
            }
        }

        function showDashboard() {
            showView('dashboard');
        }

        function toggleMenu() {
            alert('Menu functionality - Add settings, help, or other options here');
        }

        function updateManagerDashboard() {
            let totalChecks = 0;
            areas.forEach(area => {
                const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                totalChecks += area.items.length * currentCheckItems.length;
            });

            const completedChecks = Object.keys(checks).filter(key => checks[key]).length;
            const percentage = totalChecks > 0 ? Math.round((completedChecks / totalChecks) * 100) : 0;

            let completedItems = 0;
            areas.forEach(area => {
                const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                area.items.forEach(item => {
                    const itemKey = area.id + '-' + item;
                    const itemChecks = currentCheckItems.filter(ci => checks[itemKey + '-' + ci]);
                    if (itemChecks.length === currentCheckItems.length) {
                        completedItems++;
                    }
                });
            });

            const totalItems = areas.reduce((sum, area) => sum + area.items.length, 0);

            document.getElementById('managerTotalPercent').textContent = percentage + '%';
            document.getElementById('managerCompleted').textContent = completedItems;
            document.getElementById('managerTotal').textContent = totalItems;

            const perfFill = document.getElementById('performanceFill');
            perfFill.style.width = percentage + '%';
            
            if (percentage >= 80) {
                perfFill.className = 'performance-fill excellent';
            } else if (percentage >= 60) {
                perfFill.className = 'performance-fill good';
            } else if (percentage >= 40) {
                perfFill.className = 'performance-fill warning';
            } else {
                perfFill.className = 'performance-fill poor';
            }

            updateCalendar(percentage);
            updateAreasProgress();
            updateAlerts(percentage);
            updateMetrics(percentage);
        }

        function updateCalendar(todayPercentage) {
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';

            const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const currentDay = 6;
            const daysInMonth = 31;
            const daysRemaining = daysInMonth - currentDay;

            document.getElementById('daysRemaining').textContent = daysRemaining;

            daysOfWeek.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day header';
                header.textContent = day;
                calendarGrid.appendChild(header);
            });

            for (let i = 1; i <= daysInMonth; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                
                if (i === currentDay) {
                    day.classList.add('today');
                    if (todayPercentage >= 80) {
                        day.classList.add('completed');
                    } else if (todayPercentage >= 50) {
                        day.classList.add('partial');
                    } else if (todayPercentage > 0) {
                        day.classList.add('partial');
                    }
                } else if (i < currentDay) {
                    const randomPerf = 60 + Math.random() * 40;
                    if (randomPerf >= 80) {
                        day.classList.add('completed');
                    } else if (randomPerf >= 50) {
                        day.classList.add('partial');
                    } else {
                        day.classList.add('missed');
                    }
                }
                
                day.textContent = i;
                calendarGrid.appendChild(day);
            }
        }

        function updateAreasProgress() {
            const container = document.getElementById('areasProgressContainer');
            container.innerHTML = '';

            areas.forEach(area => {
                const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                const areaChecks = Object.keys(checks).filter(k => k.startsWith(area.id + '-')).filter(k => checks[k]);
                const areaTotal = area.items.length * currentCheckItems.length;
                const areaPercentage = areaTotal > 0 ? Math.round((areaChecks.length / areaTotal) * 100) : 0;

                const item = document.createElement('div');
                item.className = 'area-progress-item';
                item.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <span style="font-size: 1.5rem;">${area.icon}</span>
                        <div>
                            <div style="font-weight: 500; color: #2d3748;">${area.name}</div>
                            <div style="font-size: 0.85rem; color: #718096;">${area.items.length} items</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.2rem; font-weight: bold; color: ${areaPercentage >= 80 ? '#16a34a' : areaPercentage >= 50 ? '#f59e0b' : '#ef4444'};">
                            ${areaPercentage}%
                        </div>
                        <span class="stat-badge" style="background: ${areaPercentage >= 80 ? '#d1fae5' : areaPercentage >= 50 ? '#fef3c7' : '#fee2e2'}; color: ${areaPercentage >= 80 ? '#059669' : areaPercentage >= 50 ? '#d97706' : '#dc2626'};">
                            ${areaPercentage >= 80 ? 'Excellent' : areaPercentage >= 50 ? 'Fair' : 'Needs Work'}
                        </span>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function updateAlerts(percentage) {
            const alertSection = document.getElementById('alertSection');
            alertSection.innerHTML = '';

            const currentDay = 6;
            const daysInMonth = 31;
            const daysRemaining = daysInMonth - currentDay;
            const daysElapsed = currentDay;
            const expectedProgress = (daysElapsed / daysInMonth) * 100;

            if (daysRemaining <= 7 && percentage < 50) {
                const alert = document.createElement('div');
                alert.className = 'alert-box alert-danger';
                alert.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="font-size: 1.5rem;">üö®</div>
                        <div>
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Critical: End of Month Alert</div>
                            <div style="font-size: 0.9rem;">Only ${daysRemaining} days remaining with ${percentage}% completion. Immediate discussion with maintenance required!</div>
                        </div>
                    </div>
                `;
                alertSection.appendChild(alert);
            } else if (daysRemaining <= 7 && percentage < 80) {
                const alert = document.createElement('div');
                alert.className = 'alert-box alert-warning';
                alert.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="font-size: 1.5rem;">‚ö†Ô∏è</div>
                        <div>
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Warning: Below Target</div>
                            <div style="font-size: 0.9rem;">Only ${daysRemaining} days left. Current completion: ${percentage}%. Consider accelerating maintenance schedule.</div>
                        </div>
                    </div>
                `;
                alertSection.appendChild(alert);
            }

            if (percentage < expectedProgress - 10) {
                const alert = document.createElement('div');
                alert.className = 'alert-box alert-warning';
                alert.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="font-size: 1.5rem;">üìâ</div>
                        <div>
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Behind Schedule</div>
                            <div style="font-size: 0.9rem;">Expected ${Math.round(expectedProgress)}% by day ${currentDay}, but only ${percentage}% completed.</div>
                        </div>
                    </div>
                `;
                alertSection.appendChild(alert);
            }

            if (percentage >= 90) {
                const alert = document.createElement('div');
                alert.className = 'alert-box alert-success';
                alert.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="font-size: 1.5rem;">‚úÖ</div>
                        <div>
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Excellent Performance!</div>
                            <div style="font-size: 0.9rem;">Maintenance team is performing exceptionally well with ${percentage}% completion.</div>
                        </div>
                    </div>
                `;
                alertSection.appendChild(alert);
            }
        }

        function updateMetrics(percentage) {
            const avgDaily = Math.min(percentage, 100);
            document.getElementById('avgDailyCompletion').textContent = avgDaily + '%';

            const currentDay = 6;
            const expectedProgress = (currentDay / 31) * 100;
            const onTrack = percentage >= expectedProgress - 5;
            
            document.getElementById('onTrack').textContent = onTrack ? 'Yes' : 'No';
            document.getElementById('onTrack').style.color = onTrack ? '#2563eb' : '#ef4444';
        }

        function archiveCurrentMonth() {
            const currentDate = new Date();
            const monthName = 'October 2025';
            
            const archive = {
                id: Date.now(),
                month: monthName,
                date: currentDate.toISOString(),
                checks: JSON.parse(JSON.stringify(checks)),
                notes: JSON.parse(JSON.stringify(notes)),
                photos: JSON.parse(JSON.stringify(photos)),
                waterTemperatures: JSON.parse(JSON.stringify(waterTemperatures)),
                areas: JSON.parse(JSON.stringify(areas))
            };
            
            let totalChecks = 0;
            areas.forEach(area => {
                const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                totalChecks += area.items.length * currentCheckItems.length;
            });
            
            const completedChecks = Object.keys(checks).filter(key => checks[key]).length;
            archive.completionRate = totalChecks > 0 ? Math.round((completedChecks / totalChecks) * 100) : 0;
            
            monthlyArchives.unshift(archive);
            
            if (confirm('Archive created! Do you want to reset all checks for the new month?')) {
                checks = {};
                notes = {};
                photos = {};
                waterTemperatures = {};
                updateStats();
                renderAreas();
            }
            
            alert('‚úÖ Month archived successfully!');
            loadArchives();
        }

        function loadArchives() {
            const container = document.getElementById('archivesContainer');
            
            if (monthlyArchives.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #9ca3af;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üì¶</div>
                        <p>No archived months yet</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Archive the current month to save records</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            monthlyArchives.forEach((archive, index) => {
                const card = document.createElement('div');
                card.className = 'archive-card';
                card.onclick = () => viewArchive(index);
                
                const date = new Date(archive.date);
                const formattedDate = date.toLocaleDateString('en-GB', { 
                    day: 'numeric', 
                    month: 'long', 
                    year: 'numeric' 
                });
                
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 1.2rem; font-weight: 600; color: #2d3748; margin-bottom: 0.25rem;">
                                üìÖ ${archive.month}
                            </div>
                            <div style="font-size: 0.9rem; color: #718096;">
                                Archived: ${formattedDate}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.8rem; font-weight: bold; color: ${archive.completionRate >= 80 ? '#16a34a' : archive.completionRate >= 50 ? '#f59e0b' : '#ef4444'};">
                                ${archive.completionRate}%
                            </div>
                            <div style="font-size: 0.85rem; color: #718096;">Complete</div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e5e7eb; display: flex; gap: 0.5rem;">
                        <button onclick="event.stopPropagation(); viewArchive(${index})" 
                                style="flex: 1; padding: 0.5rem; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
                            üëÅÔ∏è View
                        </button>
                        <button onclick="event.stopPropagation(); printArchive(${index})" 
                                style="flex: 1; padding: 0.5rem; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
                            üñ®Ô∏è Print
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function viewArchive(index) {
            const archive = monthlyArchives[index];
            const printContent = document.getElementById('printContent');
            printContent.innerHTML = generatePrintHTML(archive);
            showView('print');
        }

        function printArchive(index) {
            const archive = monthlyArchives[index];
            const printContent = document.getElementById('printContent');
            printContent.innerHTML = generatePrintHTML(archive);
            showView('print');
            
            setTimeout(() => {
                window.print();
            }, 500);
        }

        function generatePrintHTML(archive) {
            let html = `
                <div style="margin-bottom: 2rem;">
                    <h2 style="font-size: 1.5rem; font-weight: bold; color: #2d3748; margin-bottom: 0.5rem;">${archive.month}</h2>
                    <p style="color: #718096;">Completion Rate: <strong style="color: ${archive.completionRate >= 80 ? '#16a34a' : archive.completionRate >= 50 ? '#f59e0b' : '#ef4444'};">${archive.completionRate}%</strong></p>
                </div>
            `;

            archive.areas.forEach(area => {
                html += `<div style="margin-bottom: 2rem; page-break-inside: avoid;">
                    <h3 style="font-size: 1.2rem; font-weight: 600; color: #2d3748; margin-bottom: 1rem;">${area.icon} ${area.name}</h3>
                `;

                area.items.forEach(item => {
                    const itemKey = area.id + '-' + item;
                    const currentCheckItems = checkItemsByArea[area.id] || checkItemsByArea['default'];
                    
                    html += `<div style="margin-bottom: 1.5rem; padding: 1rem; background: #f7fafc; border-radius: 8px;">
                        <h4 style="font-weight: 600; margin-bottom: 0.75rem;">${item}</h4>
                        <ul style="list-style: none; padding-left: 0;">
                    `;

                    currentCheckItems.forEach(checkItem => {
                        const checkKey = itemKey + '-' + checkItem;
                        const isChecked = archive.checks[checkKey];
                        html += `<li style="margin-bottom: 0.5rem;">${isChecked ? '‚úÖ' : '‚ùå'} ${checkItem}</li>`;
                    });

                    html += `</ul>`;

                    if (archive.notes[itemKey]) {
                        html += `<div style="margin-top: 0.75rem; padding: 0.75rem; background: white; border-radius: 6px;">
                            <strong>Notes:</strong> ${archive.notes[itemKey]}
                        </div>`;
                    }

                    if (archive.photos[itemKey]) {
                        html += `<div style="margin-top: 0.5rem; color: #667eea;">
                            üì∑ ${archive.photos[itemKey]} photo(s) attached
                        </div>`;
                    }

                    html += `</div>`;
                });

                html += `</div>`;
            });

            return html;
        }

        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.getElementById('passwordModal').classList.contains('show')) {
                verifyPassword();
            }
        });

        init();
    </script>
    <script>
// Get the maintenance person's name from login
window.addEventListener('DOMContentLoaded', function() {
    const maintenanceName = localStorage.getItem('maintenanceName');
    const loginTime = localStorage.getItem('loginTime');
    
    if (maintenanceName) {
        document.getElementById('technicianName').textContent = maintenanceName;
        
        if (loginTime) {
            const date = new Date(loginTime);
            document.getElementById('loginTime').textContent = 
                'Logged in: ' + date.toLocaleDateString() + ' at ' + date.toLocaleTimeString();
        }
    } else {
        // If no name found, redirect back to login
        window.location.href = 'login.html';
    }
});
</script>
</body>
</html>